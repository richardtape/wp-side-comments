$ = jQuery;
/**
 * Require the given path.
 *
 * @param {String} path
 * @return {Object} exports
 * @api public
 */

function require(path, parent, orig) {
    var resolved = require.resolve(path);

    // lookup failed
    if (null == resolved) {
        orig = orig || path;
        parent = parent || 'root';
        var err = new Error('Failed to require "' + orig + '" from "' + parent + '"');
        err.path = orig;
        err.parent = parent;
        err.require = true;
        throw err;
    }

    var module = require.modules[resolved];

    // perform real require()
    // by invoking the module's
    // registered function
    if (!module._resolving && !module.exports) {
        var mod = {};
        mod.exports = {};
        mod.client = mod.component = true;
        module._resolving = true;
        module.call(this, mod.exports, require.relative(resolved), mod);
        delete module._resolving;
        module.exports = mod.exports;
    }

    return module.exports;
}

/**
 * Registered modules.
 */

require.modules = {};

/**
 * Registered aliases.
 */

require.aliases = {};

/**
 * Resolve `path`.
 *
 * Lookup:
 *
 *   - PATH/index.js
 *   - PATH.js
 *   - PATH
 *
 * @param {String} path
 * @return {String} path or null
 * @api private
 */

require.resolve = function (path) {
    if (path.charAt(0) === '/') path = path.slice(1);

    var paths = [
        path,
        path + '.js',
        path + '.json',
        path + '/index.js',
        path + '/index.json'
    ];

    for (var i = 0; i < paths.length; i++) {
        var path = paths[i];
        if (require.modules.hasOwnProperty(path)) return path;
        if (require.aliases.hasOwnProperty(path)) return require.aliases[path];
    }
};

/**
 * Normalize `path` relative to the current path.
 *
 * @param {String} curr
 * @param {String} path
 * @return {String}
 * @api private
 */

require.normalize = function (curr, path) {
    var segs = [];

    if ('.' != path.charAt(0)) return path;

    curr = curr.split('/');
    path = path.split('/');

    for (var i = 0; i < path.length; ++i) {
        if ('..' == path[i]) {
            curr.pop();
        } else if ('.' != path[i] && '' != path[i]) {
            segs.push(path[i]);
        }
    }

    return curr.concat(segs).join('/');
};

/**
 * Register module at `path` with callback `definition`.
 *
 * @param {String} path
 * @param {Function} definition
 * @api private
 */

require.register = function (path, definition) {
    require.modules[path] = definition;
};

/**
 * Alias a module definition.
 *
 * @param {String} from
 * @param {String} to
 * @api private
 */

require.alias = function (from, to) {
    if (!require.modules.hasOwnProperty(from)) {
        throw new Error('Failed to alias "' + from + '", it does not exist');
    }
    require.aliases[to] = from;
};

/**
 * Return a require function relative to the `parent` path.
 *
 * @param {String} parent
 * @return {Function}
 * @api private
 */

require.relative = function (parent) {
    var p = require.normalize(parent, '..');

    /**
     * lastIndexOf helper.
     */

    function lastIndexOf(arr, obj) {
        var i = arr.length;
        while (i--) {
            if (arr[i] === obj) return i;
        }
        return -1;
    }

    /**
     * The relative require() itself.
     */

    function localRequire(path) {
        var resolved = localRequire.resolve(path);
        return require(resolved, parent, path);
    }

    /**
     * Resolve relative to the parent.
     */

    localRequire.resolve = function (path) {
        var c = path.charAt(0);
        if ('/' == c) return path.slice(1);
        if ('.' == c) return require.normalize(p, path);

        // resolve deps by returning
        // the dep in the nearest "deps"
        // directory
        var segs = parent.split('/');
        var i = lastIndexOf(segs, 'deps') + 1;
        if (!i) i = 0;
        path = segs.slice(0, i + 1).join('/') + '/deps/' + path;
        return path;
    };

    /**
     * Check if module is defined at `path`.
     */

    localRequire.exists = function (path) {
        return require.modules.hasOwnProperty(localRequire.resolve(path));
    };

    return localRequire;
};
require.register("component-emitter/index.js", function (exports, require, module) {

    /**
     * Expose `Emitter`.
     */

    module.exports = Emitter;

    /**
     * Initialize a new `Emitter`.
     *
     * @api public
     */

    function Emitter(obj) {
        if (obj) return mixin(obj);
    };

    /**
     * Mixin the emitter properties.
     *
     * @param {Object} obj
     * @return {Object}
     * @api private
     */

    function mixin(obj) {
        for (var key in Emitter.prototype) {
            obj[key] = Emitter.prototype[key];
        }
        return obj;
    }

    /**
     * Listen on the given `event` with `fn`.
     *
     * @param {String} event
     * @param {Function} fn
     * @return {Emitter}
     * @api public
     */

    Emitter.prototype.on =
        Emitter.prototype.addEventListener = function (event, fn) {
            this._callbacks = this._callbacks || {};
            (this._callbacks[event] = this._callbacks[event] || [])
                .push(fn);
            return this;
        };

    /**
     * Adds an `event` listener that will be invoked a single
     * time then automatically removed.
     *
     * @param {String} event
     * @param {Function} fn
     * @return {Emitter}
     * @api public
     */

    Emitter.prototype.once = function (event, fn) {
        var self = this;
        this._callbacks = this._callbacks || {};

        function on() {
            self.off(event, on);
            fn.apply(this, arguments);
        }

        on.fn = fn;
        this.on(event, on);
        return this;
    };

    /**
     * Remove the given callback for `event` or all
     * registered callbacks.
     *
     * @param {String} event
     * @param {Function} fn
     * @return {Emitter}
     * @api public
     */

    Emitter.prototype.off =
        Emitter.prototype.removeListener =
            Emitter.prototype.removeAllListeners =
                Emitter.prototype.removeEventListener = function (event, fn) {
                    this._callbacks = this._callbacks || {};

                    // all
                    if (0 == arguments.length) {
                        this._callbacks = {};
                        return this;
                    }

                    // specific event
                    var callbacks = this._callbacks[event];
                    if (!callbacks) return this;

                    // remove all handlers
                    if (1 == arguments.length) {
                        delete this._callbacks[event];
                        return this;
                    }

                    // remove specific handler
                    var cb;
                    for (var i = 0; i < callbacks.length; i++) {
                        cb = callbacks[i];
                        if (cb === fn || cb.fn === fn) {
                            callbacks.splice(i, 1);
                            break;
                        }
                    }
                    return this;
                };

    /**
     * Emit `event` with the given args.
     *
     * @param {String} event
     * @param {Mixed} ...
     * @return {Emitter}
     */

    Emitter.prototype.emit = function (event) {
        this._callbacks = this._callbacks || {};
        var args = [].slice.call(arguments, 1)
            , callbacks = this._callbacks[event];

        if (callbacks) {
            callbacks = callbacks.slice(0);
            for (var i = 0, len = callbacks.length; i < len; ++i) {
                callbacks[i].apply(this, args);
            }
        }

        return this;
    };

    /**
     * Return array of callbacks for `event`.
     *
     * @param {String} event
     * @return {Array}
     * @api public
     */

    Emitter.prototype.listeners = function (event) {
        this._callbacks = this._callbacks || {};
        return this._callbacks[event] || [];
    };

    /**
     * Check if this emitter has `event` handlers.
     *
     * @param {String} event
     * @return {Boolean}
     * @api public
     */

    Emitter.prototype.hasListeners = function (event) {
        return !!this.listeners(event).length;
    };

});
require.register("side-comments/js/main.js", function (exports, require, module) {
    var _ = require('./vendor/lodash-custom.js');
    var Section = require('./section.js');
    var Emitter = require('emitter');
    var eventPipe = new Emitter;

    /**
     * Creates a new SideComments instance.
     * @param {Object} el               The selector for the element for
     *                                  which side comments need to be initialized
     * @param {Object} currentUser      An object defining the current user. Used
     *                                  for posting new comments and deciding
     *                                  whether existing ones can be deleted
     *                                  or not.
     * @param {Array} existingComments An array of existing comments, in
     *                                 the proper structure.
     *
     * TODO: **GIVE EXAMPLE OF STRUCTURE HERE***
     */
    function SideComments(el, currentUser, existingComments) {
        this.$el = $(el);
        this.$body = $('body');
        this.eventPipe = eventPipe;

        this.currentUser = _.clone(currentUser) || null;
        this.existingComments = _.cloneDeep(existingComments) || [];
        this.sections = [];
        this.activeSection = null;

        // Event bindings
        this.eventPipe.on('showComments', _.bind(this.showComments, this));
        this.eventPipe.on('hideComments', _.bind(this.hideComments, this));
        this.eventPipe.on('sectionSelected', _.bind(this.sectionSelected, this));
        this.eventPipe.on('sectionDeselected', _.bind(this.sectionDeselected, this));
        this.eventPipe.on('commentPosted', _.bind(this.commentPosted, this));
        this.eventPipe.on('commentDeleted', _.bind(this.commentDeleted, this));
        this.eventPipe.on('addCommentAttempted', _.bind(this.addCommentAttempted, this));
        this.$body.on('click', _.bind(this.bodyClick, this));
        this.initialize(this.existingComments);
    }

// Mix in Emitter
    Emitter(SideComments.prototype);

/**
 * Adds the comments beside each commentable section.
 */
SideComments.prototype.initialize = function (existingComments) {
  _.each(this.$el.find('.commentable-section'), function (section) {
    var $section = $(section);
    var sectionId = $section.data('section-id').toString();
    var sectionComments = _.find(this.existingComments, {sectionId: sectionId});

    //evita que o bloco de comentários seja exibido para blocos que não tem comentários e não estão logados.
    if (sectionComments || this.currentUser) {
      this.sections.push(new Section(this.eventPipe, $section, this.currentUser, sectionComments));
    }

  }, this);
};

    /**
     * Shows the side comments.
     */
    SideComments.prototype.showComments = function () {
        this.$el.addClass('side-comments-open');
    };

    /**
     * Hide the comments.
     */
    SideComments.prototype.hideComments = function () {
        if (this.activeSection) {
            this.activeSection.deselect();
            this.activeSection = null;
        }

        this.$el.removeClass('side-comments-open');
        this.$el.find('.commentable-section').removeClass('active');
    };

    /**
     * Callback after a section has been selected.
     * @param  {Object} section The Section object to be selected.
     */
    SideComments.prototype.sectionSelected = function (section) {
        this.showComments();

        if (this.activeSection) {
            this.activeSection.deselect();
        }

        this.activeSection = section;
    };

    /**
     * Callback after a section has been deselected.
     * @param  {Object} section The Section object to be selected.
     */
    SideComments.prototype.sectionDeselected = function (section) {
        this.hideComments();
        this.activeSection = null;
    };

    /**
     * Fired when the commentPosted event is triggered.
     * @param  {Object} comment  The comment object to be posted.
     */
    SideComments.prototype.commentPosted = function (comment) {
        this.emit('commentPosted', comment);
    };

    /**
     * Fired when the commentDeleted event is triggered.
     * @param  {Object} comment  The commentId of the deleted comment.
     */
    SideComments.prototype.commentDeleted = function (comment) {
        this.emit('commentDeleted', comment);
    };

    /**
     * Fire an event to to signal that a comment as attempted to be added without
     * a currentUser.
     */
    SideComments.prototype.addCommentAttempted = function () {
        this.emit('addCommentAttempted');
    };

    /**
     * Inserts the given comment into the right section.
     * @param  {Object} comment A comment to be inserted.
     */
    SideComments.prototype.insertComment = function (comment) {
        var section = _.find(this.sections, {id: comment.sectionId});
        section.insertComment(comment);
    };

    /**
     * Removes the given comment from the right section.
     * @param sectionId The ID of the section where the comment exists.
     * @param commentId The ID of the comment to be removed.
     */
    SideComments.prototype.removeComment = function (sectionId, commentId) {
        var section = _.find(this.sections, {id: sectionId});
        section.removeComment(commentId);
    };

    /**
     * Delete the comment specified by the given sectionID and commentID.
     * @param sectionId The section the comment belongs to.
     * @param commentId The comment's ID
     */
    SideComments.prototype.deleteComment = function (sectionId, commentId) {
        var section = _.find(this.sections, {id: sectionId});
        section.deleteComment(commentId);
    };

    /**
     * Checks if comments are visible or not.
     * @return {Boolean} Whether or not the comments are visible.
     */
    SideComments.prototype.commentsAreVisible = function () {
        return this.$el.hasClass('side-comments-open');
    };

    /**
     * Callback for body clicks. We hide the comments if someone clicks outside of the comments section.
     * @param  {Object} event The event object.
     */
    SideComments.prototype.bodyClick = function (event) {
        var $target = $(event.target);

        // We do a check on $('body') existing here because if the $target has
        // no parent body then it's because it belongs to a deleted comment and
        // we should NOT hide the SideComments.
        if ($target.closest('.side-comment').length < 1 && $target.closest('body').length > 0) {
            if (this.activeSection) {
                this.activeSection.deselect();
            }
            this.hideComments();
        }
    };

    /**
     * Set the currentUser and update the UI as necessary.
     * @param {Object} currentUser The currentUser to be used.
     */
    SideComments.prototype.setCurrentUser = function (currentUser) {
        this.hideComments();
        this.currentUser = currentUser;
        _.each(this.sections, function (section) {
            section.currentUser = this.currentUser;
            section.render();
        });
    };

    /**
     * Remove the currentUser and update the UI as necessary.
     */
    SideComments.prototype.removeCurrentUser = function () {
        this.hideComments();
        this.currentUser = null;
        _.each(this.sections, function (section) {
            section.currentUser = null;
            section.render();
        });
    };

    /**
     * Destroys the instance of SideComments, including unbinding from DOM events.
     */
    SideComments.prototype.destroy = function () {
        this.hideComments();
        this.$el.off();
    };

    module.exports = SideComments;
});
require.register("side-comments/js/section.js", function (exports, require, module) {
    var _ = require('./vendor/lodash-custom.js');
    var Template = require('../templates/section.html');
    var CommentTemplate = require('../templates/comment.html');
    var mobileCheck = require('./helpers/mobile-check.js');

    /**
     * Creates a new Section object, which is responsible for managing a
     * single comment section.
     * @param {Object} eventPipe The Emitter object used for passing around events.
     * @param {Array} comments   The array of comments for this section. Optional.
     */
    function Section(eventPipe, $el, currentUser, comments) {
        this.eventPipe = eventPipe;
        this.$el = $el;
        this.comments = comments ? comments.comments : [];
        this.currentUser = currentUser || null;
        this.clickEventName = mobileCheck() ? 'touchstart' : 'click';

        this.id = $el.data('section-id');

        this.$el.on(this.clickEventName, '.side-comment .marker', _.bind(this.markerClick, this));
        this.$el.on(this.clickEventName, '.side-comment .add-comment', _.bind(this.addCommentClick, this));
        this.$el.on(this.clickEventName, '.side-comment .add-reply', _.bind(this.addReplyClick, this));
        this.$el.on(this.clickEventName, '.side-comment .post', _.bind(this.postCommentClick, this));
        this.$el.on(this.clickEventName, '.side-comment .reply', _.bind(this.postCommentClick, this));
        this.$el.on(this.clickEventName, '.side-comment .cancel', _.bind(this.cancelCommentClick, this));
        this.$el.on(this.clickEventName, '.side-comment .delete', _.bind(this.deleteCommentClick, this));
        this.render();
    }

    /**
     * Click callback event on markers.
     * @param  {Object} event The event object.
     */
    Section.prototype.markerClick = function (event) {
        event.preventDefault();

        var com_sec = jQuery(event.target).parents('.commentable-section:first');

        if (com_sec.find('.active').length == 0 && !jQuery(event.target).hasClass('fa-times')) {
            this.select();
        }
    };

    /**
     * Callback for the comment button click event.
     * @param {Object} event The event object.
     */
    Section.prototype.addCommentClick = function (event) {
        event.preventDefault();
        if (this.currentUser) {
            this.showCommentForm("0", "");
        } else {
            this.eventPipe.emit('addCommentAttempted');
        }
    };

    /**
     * Callback for the comment button click event.
     * @param {Object} event The event object.
     */
    Section.prototype.addReplyClick = function (event) {
        event.preventDefault();
        if (this.currentUser) {
            var parentID = event.currentTarget.attributes["data-parent"].value;
            var commentID = event.currentTarget.attributes["data-comment"].value;
            this.showCommentForm(parentID, commentID);
        } else {
            this.eventPipe.emit('addCommentAttempted');//TODO
        }
    };

    /**
     * Show the comment form for this section.
     */
    Section.prototype.showCommentForm = function (parentID, commentID) {
        this.hideCommentForm();
        if (this.comments.length > 0) {
            this.$el.find('.add-comment[data-comment="' + commentID + '"]').addClass('hide');
            this.$el.find('.add-reply[data-comment="' + commentID + '"]').addClass('hide');
            this.$el.find('.comment-form[data-comment="' + commentID + '"]').addClass('active');
        }

        this.focusCommentBox(parentID, commentID);
    };

    /**
     * Hides the comment form for this section.
     */
    Section.prototype.hideCommentForm = function () {
        if (this.comments.length > 0) {
            this.$el.find('.add-comment').removeClass('hide');
            this.$el.find('.add-reply').removeClass('hide');
            this.$el.find('.comment-form').removeClass('active');
        }

        this.$el.find('.comment-box:not(.register-login)').empty();
    };

    /**
     * Focus on the comment box in the comment form.
     */
    Section.prototype.focusCommentBox = function (parentID, commentID) {
        if (this.$el.find('.comment-box[data-comment="' + commentID + '"]').length > 0 && commentID != "") {
            this.$el.find('.comment-box[data-comment="' + commentID + '"]').get(0).focus();
        } else {
            this.$el.find('.comment-form[data-parent="0"][data-comment=""] .comment-box').get(0).focus();
        }
    };

    /**
     * Cancel comment callback.
     * @param  {Object} event The event object.
     */
    Section.prototype.cancelCommentClick = function (event) {
        event.preventDefault();
        var parentID = event.currentTarget.attributes["data-parent"].value;
        var commentID = event.currentTarget.attributes["data-comment"].value;
        this.cancelComment(parentID, commentID);
    };

    /**
     * Cancel adding of a comment.
     */
    Section.prototype.cancelComment = function (parentID, commentID) {
        if (this.comments.length > 0) {
            this.hideCommentForm();
        } else {
            this.deselect();
            this.eventPipe.emit('hideComments');
        }
    };

    /**
     * Post comment callback.
     * @param  {Object} event The event object.
     */
    Section.prototype.postCommentClick = function (event) {
        event.preventDefault();
        var parentID = event.currentTarget.attributes["data-parent"].value;
        var commentID = event.currentTarget.attributes["data-comment"].value;
        this.postComment(parentID, commentID);
    };

    /**
     * Post a comment to this section.
     */
    Section.prototype.postComment = function (parentID, commentID) {
        var commentBody = "";
        if (commentID != "") {
            this.$el.find(".comment-box[data-parent='" + parentID + "'][data-comment='" + commentID + "']").children().not("br").each(function () {
                $(this).relaceWith(this.innerHTML);
            });
            commentBody = this.$el.find('.comment-box[data-parent="' + parentID + '"][data-comment="' + commentID + '"]').html();
        } else {
            this.$el.find('.comment-form[data-parent="0"][data-comment=""] .comment-box').children().not("br").each(function () {
                $(this).relaceWith(this.innerHTML);
            });
            commentBody = this.$el.find('.comment-form[data-parent="0"][data-comment=""] .comment-box').html();
        }
        if (commentID == "") commentID = 0;
        var comment = {
            sectionId: this.id,
            comment: commentBody,
            authorAvatarUrl: this.currentUser.avatarUrl,
            authorName: this.currentUser.name,
            authorId: this.currentUser.id,
            parentID: commentID
        };
        this.eventPipe.emit('commentPosted', comment);
    };

    /**
     * Insert a comment into this sections comment list.
     * @param  {Object} comment A comment object.
     */
    Section.prototype.insertComment = function (comment) {
        this.comments.push(comment);
        var newCommentHtml = _.template(CommentTemplate, {
            comment: comment,
            currentUser: this.currentUser
        });
        if (comment.parentID != "0") {
            var parentID = comment.parentID,
                parentOfCurrent = this.$el.find('li[data-comment-id="'+parentID+'"]');
            if (parentOfCurrent.find('ul[data-root-id="' + parentID + '"]').length == 0) {
                parentOfCurrent.append('<ul class="comments" data-root-id="' + parentID + '"></ul>');
            }
            parentOfCurrent.find('ul[data-root-id="' + parentID + '"]').append(newCommentHtml);
        } else {
            this.$el.find('.comments[data-root-id="0"]').append(newCommentHtml);
        }
        //visual feedback for the users
        //    first move the screen to the comment
        $('li[data-comment-id="' + comment.commentID + '"]').parent().scrollTop($('li[data-comment-id="' + comment.commentID + '"]').parent().height() + $('li[data-comment-id="' + comment.commentID + '"]').parent().scrollTop());
        //    then fadeIn the comment.
        $('li[data-comment-id="' + comment.commentID + '"]').hide().fadeIn(2000);
        this.$el.find('.side-comment').addClass('has-comments');
        this.updateCommentCount();
        this.hideCommentForm();
    };

    /**
     * Increments the comment count for a given section.
     */
    Section.prototype.updateCommentCount = function () {
        this.$el.find('.marker span').text(this.comments.length);
    };

    /**
     * Event handler for delete comment clicks.
     * @param  {Object} event The event object.
     */
    Section.prototype.deleteCommentClick = function (event) {
        event.preventDefault();
        var commentId = $(event.target).closest('li').data('comment-id');

        if (window.confirm("Are you sure you want to delete this comment?")) {
            this.deleteComment(commentId);
        }
    };

    /**
     * Finds the comment and emits an event with the comment to be deleted.
     */
    Section.prototype.deleteComment = function (commentId) {
        var comment = _.find(this.comments, {id: commentId});
        comment.sectionId = this.id;
        this.eventPipe.emit('commentDeleted', comment);
    };

    /**
     * Removes the comment from the list of comments and the comment array.
     * @param commentId The ID of the comment to be removed from this section.
     */
    Section.prototype.removeComment = function (commentId) {
        this.comments = _.reject(this.comments, {id: commentId});
        this.$el.find('.side-comment .comments li[data-comment-id="' + commentId + '"]').remove();
        this.updateCommentCount();
        if (this.comments.length < 1) {
            this.$el.find('.side-comment').removeClass('has-comments');
        }
    };

    /**
     * Mark this section as selected. Delsect if this section is already selected.
     */
    Section.prototype.select = function () {
        if (this.isSelected()) {
            this.deselect();
            this.eventPipe.emit('sectionDeselected', this);
        } else {
            this.$el.find('.side-comment').addClass('active');

            if (this.comments.length === 0 && this.currentUser) {
                this.focusCommentBox("0", "");
            }

            this.eventPipe.emit('sectionSelected', this);
        }
    };

    /**
     * Deselect this section.
     */
    Section.prototype.deselect = function () {
        this.$el.find('.side-comment').removeClass('active');
        this.$el.removeClass('active');
        this.hideCommentForm();
    };

    Section.prototype.isSelected = function () {
        return this.$el.find('.side-comment').hasClass('active');
    };

    /**
     * Get the class to be used on the side comment section wrapper.
     * @return {String} The class names to use.
     */
    Section.prototype.sectionClasses = function () {
        var classes = '';

        if (this.comments.length > 0) {
            classes = classes + ' has-comments';
        }
        if (!this.currentUser) {
            classes = classes + ' no-current-user'
        }

        return classes;
    };

    /**
     * Render this section into the DOM.
     */
    Section.prototype.render = function () {
        this.$el.find('.side-comment').remove();
        var sideCommentWrap = $(_.template(Template, {
            commentTemplate: CommentTemplate,
            comments: this.comments,
            sectionClasses: this.sectionClasses(),
            currentUser: this.currentUser
        }));

        $(sideCommentWrap.find(".comments li")).each(function (key, com) {
            var currentComment = $(com);

            // Need to put the comment threaded to it's parent
            if (currentComment.data("parent-id") != "0") {
                var parentID = currentComment.data('parent-id'),
                    parentOfCurrentComment = $(sideCommentWrap).find("li[data-comment-id='" + parentID + "']");
                if (parentOfCurrentComment.find("ul[data-root-id='" + parentID + "']").length == 0) {
                    parentOfCurrentComment.append("<ul class='comments' data-root-id='" + parentID + "'></ul>");
                }
                parentOfCurrentComment.find("ul[data-root-id='" + parentID + "']").append(currentComment);
            }
        });
        sideCommentWrap.appendTo(this.$el);
    };

    /**
     * Desttroy this Section object. Generally meaning unbind events.
     */
    Section.prototype.destroy = function () {
        this.$el.off();
    }

    module.exports = Section;
});
require.register("side-comments/js/vendor/lodash-custom.js", function (exports, require, module) {
    /**
     * @license
     * Lo-Dash 2.4.1 (Custom Build) <http://lodash.com/>
     * Build: `lodash exports="node,commonjs" include="each,bind,find,template,reject,clone,cloneDeep"`
     * Copyright 2012-2013 The Dojo Foundation <http://dojofoundation.org/>
     * Based on Underscore.js 1.5.2 <http://underscorejs.org/LICENSE>
     * Copyright 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
     * Available under MIT license <http://lodash.com/license>
     */
    ;
    (function () {

        /** Used as a safe reference for `undefined` in pre ES5 environments */
        var undefined;

        /** Used to pool arrays and objects used internally */
        var arrayPool = [];

        /** Used internally to indicate various things */
        var indicatorObject = {};

        /** Used as the max size of the `arrayPool` and `objectPool` */
        var maxPoolSize = 40;

        /** Used to match empty string literals in compiled template source */
        var reEmptyStringLeading = /\b__p \+= '';/g,
            reEmptyStringMiddle = /\b(__p \+=) '' \+/g,
            reEmptyStringTrailing = /(__e\(.*?\)|\b__t\)) \+\n'';/g;

        /**
         * Used to match ES6 template delimiters
         * http://people.mozilla.org/~jorendorff/es6-draft.html#sec-literals-string-literals
         */
        var reEsTemplate = /\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;

        /** Used to match regexp flags from their coerced string values */
        var reFlags = /\w*$/;

        /** Used to detected named functions */
        var reFuncName = /^\s*function[ \n\r\t]+\w/;

        /** Used to match "interpolate" template delimiters */
        var reInterpolate = /<%=([\s\S]+?)%>/g;

        /** Used to ensure capturing order of template delimiters */
        var reNoMatch = /($^)/;

        /** Used to detect functions containing a `this` reference */
        var reThis = /\bthis\b/;

        /** Used to match unescaped characters in compiled string literals */
        var reUnescapedString = /['\n\r\t\u2028\u2029\\]/g;

        /** Used to fix the JScript [[DontEnum]] bug */
        var shadowedProps = [
            'constructor', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable',
            'toLocaleString', 'toString', 'valueOf'
        ];

        /** Used to make template sourceURLs easier to identify */
        var templateCounter = 0;

        /** `Object#toString` result shortcuts */
        var argsClass = '[object Arguments]',
            arrayClass = '[object Array]',
            boolClass = '[object Boolean]',
            dateClass = '[object Date]',
            errorClass = '[object Error]',
            funcClass = '[object Function]',
            numberClass = '[object Number]',
            objectClass = '[object Object]',
            regexpClass = '[object RegExp]',
            stringClass = '[object String]';

        /** Used to identify object classifications that `_.clone` supports */
        var cloneableClasses = {};
        cloneableClasses[funcClass] = false;
        cloneableClasses[argsClass] = cloneableClasses[arrayClass] =
            cloneableClasses[boolClass] = cloneableClasses[dateClass] =
                cloneableClasses[numberClass] = cloneableClasses[objectClass] =
                    cloneableClasses[regexpClass] = cloneableClasses[stringClass] = true;

        /** Used as the property descriptor for `__bindData__` */
        var descriptor = {
            'configurable': false,
            'enumerable': false,
            'value': null,
            'writable': false
        };

        /** Used as the data object for `iteratorTemplate` */
        var iteratorData = {
            'args': '',
            'array': null,
            'bottom': '',
            'firstArg': '',
            'init': '',
            'keys': null,
            'loop': '',
            'shadowedProps': null,
            'support': null,
            'top': '',
            'useHas': false
        };

        /** Used to determine if values are of the language type Object */
        var objectTypes = {
            'boolean': false,
            'function': true,
            'object': true,
            'number': false,
            'string': false,
            'undefined': false
        };

        /** Used to escape characters for inclusion in compiled string literals */
        var stringEscapes = {
            '\\': '\\',
            "'": "'",
            '\n': 'n',
            '\r': 'r',
            '\t': 't',
            '\u2028': 'u2028',
            '\u2029': 'u2029'
        };

        /** Used as a reference to the global object */
        var root = (objectTypes[typeof window] && window) || this;

        /** Detect free variable `exports` */
        var freeExports = objectTypes[typeof exports] && exports && !exports.nodeType && exports;

        /** Detect free variable `module` */
        var freeModule = objectTypes[typeof module] && module && !module.nodeType && module;

        /** Detect the popular CommonJS extension `module.exports` */
        var moduleExports = freeModule && freeModule.exports === freeExports && freeExports;

        /** Detect free variable `global` from Node.js or Browserified code and use it as `root` */
        var freeGlobal = objectTypes[typeof global] && global;
        if (freeGlobal && (freeGlobal.global === freeGlobal || freeGlobal.window === freeGlobal)) {
            root = freeGlobal;
        }

        /*--------------------------------------------------------------------------*/

        /**
         * Used by `template` to escape characters for inclusion in compiled
         * string literals.
         *
         * @private
         * @param {string} match The matched character to escape.
         * @returns {string} Returns the escaped character.
         */
        function escapeStringChar(match) {
            return '\\' + stringEscapes[match];
        }

        /**
         * Gets an array from the array pool or creates a new one if the pool is empty.
         *
         * @private
         * @returns {Array} The array from the pool.
         */
        function getArray() {
            return arrayPool.pop() || [];
        }

        /**
         * Checks if `value` is a DOM node in IE < 9.
         *
         * @private
         * @param {*} value The value to check.
         * @returns {boolean} Returns `true` if the `value` is a DOM node, else `false`.
         */
        function isNode(value) {
            // IE < 9 presents DOM nodes as `Object` objects except they have `toString`
            // methods that are `typeof` "string" and still can coerce nodes to strings
            return typeof value.toString != 'function' && typeof (value + '') == 'string';
        }

        /**
         * Releases the given array back to the array pool.
         *
         * @private
         * @param {Array} [array] The array to release.
         */
        function releaseArray(array) {
            array.length = 0;
            if (arrayPool.length < maxPoolSize) {
                arrayPool.push(array);
            }
        }

        /**
         * Slices the `collection` from the `start` index up to, but not including,
         * the `end` index.
         *
         * Note: This function is used instead of `Array#slice` to support node lists
         * in IE < 9 and to ensure dense arrays are returned.
         *
         * @private
         * @param {Array|Object|string} collection The collection to slice.
         * @param {number} start The start index.
         * @param {number} end The end index.
         * @returns {Array} Returns the new array.
         */
        function slice(array, start, end) {
            start || (start = 0);
            if (typeof end == 'undefined') {
                end = array ? array.length : 0;
            }
            var index = -1,
                length = end - start || 0,
                result = Array(length < 0 ? 0 : length);

            while (++index < length) {
                result[index] = array[start + index];
            }
            return result;
        }

        /*--------------------------------------------------------------------------*/

        /**
         * Used for `Array` method references.
         *
         * Normally `Array.prototype` would suffice, however, using an array literal
         * avoids issues in Narwhal.
         */
        var arrayRef = [];

        /** Used for native method references */
        var errorProto = Error.prototype,
            objectProto = Object.prototype,
            stringProto = String.prototype;

        /** Used to resolve the internal [[Class]] of values */
        var toString = objectProto.toString;

        /** Used to detect if a method is native */
        var reNative = RegExp('^' +
            String(toString)
                .replace(/[.*+?^${}()|[\]\\]/g, '\\$&')
                .replace(/toString| for [^\]]+/g, '.*?') + '$'
        );

        /** Native method shortcuts */
        var fnToString = Function.prototype.toString,
            hasOwnProperty = objectProto.hasOwnProperty,
            push = arrayRef.push,
            propertyIsEnumerable = objectProto.propertyIsEnumerable,
            unshift = arrayRef.unshift;

        /** Used to set meta data on functions */
        var defineProperty = (function () {
            // IE 8 only accepts DOM elements
            try {
                var o = {},
                    func = isNative(func = Object.defineProperty) && func,
                    result = func(o, o, o) && func;
            } catch (e) {
            }
            return result;
        }());

        /* Native method shortcuts for methods with the same name as other `lodash` methods */
        var nativeCreate = isNative(nativeCreate = Object.create) && nativeCreate,
            nativeIsArray = isNative(nativeIsArray = Array.isArray) && nativeIsArray,
            nativeKeys = isNative(nativeKeys = Object.keys) && nativeKeys;

        /** Used to lookup a built-in constructor by [[Class]] */
        var ctorByClass = {};
        ctorByClass[arrayClass] = Array;
        ctorByClass[boolClass] = Boolean;
        ctorByClass[dateClass] = Date;
        ctorByClass[funcClass] = Function;
        ctorByClass[objectClass] = Object;
        ctorByClass[numberClass] = Number;
        ctorByClass[regexpClass] = RegExp;
        ctorByClass[stringClass] = String;

        /** Used to avoid iterating non-enumerable properties in IE < 9 */
        var nonEnumProps = {};
        nonEnumProps[arrayClass] = nonEnumProps[dateClass] = nonEnumProps[numberClass] = {
            'constructor': true,
            'toLocaleString': true,
            'toString': true,
            'valueOf': true
        };
        nonEnumProps[boolClass] = nonEnumProps[stringClass] = {'constructor': true, 'toString': true, 'valueOf': true};
        nonEnumProps[errorClass] = nonEnumProps[funcClass] = nonEnumProps[regexpClass] = {
            'constructor': true,
            'toString': true
        };
        nonEnumProps[objectClass] = {'constructor': true};

        (function () {
            var length = shadowedProps.length;
            while (length--) {
                var key = shadowedProps[length];
                for (var className in nonEnumProps) {
                    if (hasOwnProperty.call(nonEnumProps, className) && !hasOwnProperty.call(nonEnumProps[className], key)) {
                        nonEnumProps[className][key] = false;
                    }
                }
            }
        }());

        /*--------------------------------------------------------------------------*/

        /**
         * Creates a `lodash` object which wraps the given value to enable intuitive
         * method chaining.
         *
         * In addition to Lo-Dash methods, wrappers also have the following `Array` methods:
         * `concat`, `join`, `pop`, `push`, `reverse`, `shift`, `slice`, `sort`, `splice`,
         * and `unshift`
         *
         * Chaining is supported in custom builds as long as the `value` method is
         * implicitly or explicitly included in the build.
         *
         * The chainable wrapper functions are:
         * `after`, `assign`, `bind`, `bindAll`, `bindKey`, `chain`, `compact`,
         * `compose`, `concat`, `countBy`, `create`, `createCallback`, `curry`,
         * `debounce`, `defaults`, `defer`, `delay`, `difference`, `filter`, `flatten`,
         * `forEach`, `forEachRight`, `forIn`, `forInRight`, `forOwn`, `forOwnRight`,
         * `functions`, `groupBy`, `indexBy`, `initial`, `intersection`, `invert`,
         * `invoke`, `keys`, `map`, `max`, `memoize`, `merge`, `min`, `object`, `omit`,
         * `once`, `pairs`, `partial`, `partialRight`, `pick`, `pluck`, `pull`, `push`,
         * `range`, `reject`, `remove`, `rest`, `reverse`, `shuffle`, `slice`, `sort`,
         * `sortBy`, `splice`, `tap`, `throttle`, `times`, `toArray`, `transform`,
         * `union`, `uniq`, `unshift`, `unzip`, `values`, `where`, `without`, `wrap`,
         * and `zip`
         *
         * The non-chainable wrapper functions are:
         * `clone`, `cloneDeep`, `contains`, `escape`, `every`, `find`, `findIndex`,
         * `findKey`, `findLast`, `findLastIndex`, `findLastKey`, `has`, `identity`,
         * `indexOf`, `isArguments`, `isArray`, `isBoolean`, `isDate`, `isElement`,
         * `isEmpty`, `isEqual`, `isFinite`, `isFunction`, `isNaN`, `isNull`, `isNumber`,
         * `isObject`, `isPlainObject`, `isRegExp`, `isString`, `isUndefined`, `join`,
         * `lastIndexOf`, `mixin`, `noConflict`, `parseInt`, `pop`, `random`, `reduce`,
         * `reduceRight`, `result`, `shift`, `size`, `some`, `sortedIndex`, `runInContext`,
         * `template`, `unescape`, `uniqueId`, and `value`
         *
         * The wrapper functions `first` and `last` return wrapped values when `n` is
         * provided, otherwise they return unwrapped values.
         *
         * Explicit chaining can be enabled by using the `_.chain` method.
         *
         * @name _
         * @constructor
         * @category Chaining
         * @param {*} value The value to wrap in a `lodash` instance.
         * @returns {Object} Returns a `lodash` instance.
         * @example
         *
         * var wrapped = _([1, 2, 3]);
         *
         * // returns an unwrapped value
         * wrapped.reduce(function(sum, num) {
   *   return sum + num;
   * });
         * // => 6
         *
         * // returns a wrapped value
         * var squares = wrapped.map(function(num) {
   *   return num * num;
   * });
         *
         * _.isArray(squares);
         * // => false
         *
         * _.isArray(squares.value());
         * // => true
         */
        function lodash() {
            // no operation performed
        }

        /**
         * An object used to flag environments features.
         *
         * @static
         * @memberOf _
         * @type Object
         */
        var support = lodash.support = {};

        (function () {
            var ctor = function () {
                    this.x = 1;
                },
                object = {'0': 1, 'length': 1},
                props = [];

            ctor.prototype = {'valueOf': 1, 'y': 1};
            for (var key in new ctor) {
                props.push(key);
            }
            for (key in arguments) {
            }

            /**
             * Detect if an `arguments` object's [[Class]] is resolvable (all but Firefox < 4, IE < 9).
             *
             * @memberOf _.support
             * @type boolean
             */
            support.argsClass = toString.call(arguments) == argsClass;

            /**
             * Detect if `arguments` objects are `Object` objects (all but Narwhal and Opera < 10.5).
             *
             * @memberOf _.support
             * @type boolean
             */
            support.argsObject = arguments.constructor == Object && !(arguments instanceof Array);

            /**
             * Detect if `name` or `message` properties of `Error.prototype` are
             * enumerable by default. (IE < 9, Safari < 5.1)
             *
             * @memberOf _.support
             * @type boolean
             */
            support.enumErrorProps = propertyIsEnumerable.call(errorProto, 'message') || propertyIsEnumerable.call(errorProto, 'name');

            /**
             * Detect if `prototype` properties are enumerable by default.
             *
             * Firefox < 3.6, Opera > 9.50 - Opera < 11.60, and Safari < 5.1
             * (if the prototype or a property on the prototype has been set)
             * incorrectly sets a function's `prototype` property [[Enumerable]]
             * value to `true`.
             *
             * @memberOf _.support
             * @type boolean
             */
            support.enumPrototypes = propertyIsEnumerable.call(ctor, 'prototype');

            /**
             * Detect if functions can be decompiled by `Function#toString`
             * (all but PS3 and older Opera mobile browsers & avoided in Windows 8 apps).
             *
             * @memberOf _.support
             * @type boolean
             */
            support.funcDecomp = !isNative(root.WinRTError) && reThis.test(function () {
                    return this;
                });

            /**
             * Detect if `Function#name` is supported (all but IE).
             *
             * @memberOf _.support
             * @type boolean
             */
            support.funcNames = typeof Function.name == 'string';

            /**
             * Detect if `arguments` object indexes are non-enumerable
             * (Firefox < 4, IE < 9, PhantomJS, Safari < 5.1).
             *
             * @memberOf _.support
             * @type boolean
             */
            support.nonEnumArgs = key != 0;

            /**
             * Detect if properties shadowing those on `Object.prototype` are non-enumerable.
             *
             * In IE < 9 an objects own properties, shadowing non-enumerable ones, are
             * made non-enumerable as well (a.k.a the JScript [[DontEnum]] bug).
             *
             * @memberOf _.support
             * @type boolean
             */
            support.nonEnumShadows = !/valueOf/.test(props);

            /**
             * Detect if `Array#shift` and `Array#splice` augment array-like objects correctly.
             *
             * Firefox < 10, IE compatibility mode, and IE < 9 have buggy Array `shift()`
             * and `splice()` functions that fail to remove the last element, `value[0]`,
             * of array-like objects even though the `length` property is set to `0`.
             * The `shift()` method is buggy in IE 8 compatibility mode, while `splice()`
             * is buggy regardless of mode in IE < 9 and buggy in compatibility mode in IE 9.
             *
             * @memberOf _.support
             * @type boolean
             */
            support.spliceObjects = (arrayRef.splice.call(object, 0, 1), !object[0]);

            /**
             * Detect lack of support for accessing string characters by index.
             *
             * IE < 8 can't access characters by index and IE 8 can only access
             * characters by index on string literals.
             *
             * @memberOf _.support
             * @type boolean
             */
            support.unindexedChars = ('x'[0] + Object('x')[0]) != 'xx';

            /**
             * Detect if a DOM node's [[Class]] is resolvable (all but IE < 9)
             * and that the JS engine errors when attempting to coerce an object to
             * a string without a `toString` function.
             *
             * @memberOf _.support
             * @type boolean
             */
            try {
                support.nodeClass = !(toString.call(document) == objectClass && !({'toString': 0} + ''));
            } catch (e) {
                support.nodeClass = true;
            }
        }(1));

        /**
         * By default, the template delimiters used by Lo-Dash are similar to those in
         * embedded Ruby (ERB). Change the following template settings to use alternative
         * delimiters.
         *
         * @static
         * @memberOf _
         * @type Object
         */
        lodash.templateSettings = {

            /**
             * Used to detect `data` property values to be HTML-escaped.
             *
             * @memberOf _.templateSettings
             * @type RegExp
             */
            'escape': /<%-([\s\S]+?)%>/g,

            /**
             * Used to detect code to be evaluated.
             *
             * @memberOf _.templateSettings
             * @type RegExp
             */
            'evaluate': /<%([\s\S]+?)%>/g,

            /**
             * Used to detect `data` property values to inject.
             *
             * @memberOf _.templateSettings
             * @type RegExp
             */
            'interpolate': reInterpolate,

            /**
             * Used to reference the data object in the template text.
             *
             * @memberOf _.templateSettings
             * @type string
             */
            'variable': '',

            /**
             * Used to import variables into the compiled template.
             *
             * @memberOf _.templateSettings
             * @type Object
             */
            'imports': {

                /**
                 * A reference to the `lodash` function.
                 *
                 * @memberOf _.templateSettings.imports
                 * @type Function
                 */
                '_': lodash
            }
        };

        /*--------------------------------------------------------------------------*/

        /**
         * The template used to create iterator functions.
         *
         * @private
         * @param {Object} data The data object used to populate the text.
         * @returns {string} Returns the interpolated text.
         */
        var iteratorTemplate = function (obj) {

            var __p = 'var index, iterable = ' +
                (obj.firstArg) +
                ', result = ' +
                (obj.init) +
                ';\nif (!iterable) return result;\n' +
                (obj.top) +
                ';';
            if (obj.array) {
                __p += '\nvar length = iterable.length; index = -1;\nif (' +
                    (obj.array) +
                    ') {  ';
                if (support.unindexedChars) {
                    __p += '\n  if (isString(iterable)) {\n    iterable = iterable.split(\'\')\n  }  ';
                }
                __p += '\n  while (++index < length) {\n    ' +
                    (obj.loop) +
                    ';\n  }\n}\nelse {  ';
            } else if (support.nonEnumArgs) {
                __p += '\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += \'\';\n      ' +
                    (obj.loop) +
                    ';\n    }\n  } else {  ';
            }

            if (support.enumPrototypes) {
                __p += '\n  var skipProto = typeof iterable == \'function\';\n  ';
            }

            if (support.enumErrorProps) {
                __p += '\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ';
            }

            var conditions = [];
            if (support.enumPrototypes) {
                conditions.push('!(skipProto && index == "prototype")');
            }
            if (support.enumErrorProps) {
                conditions.push('!(skipErrorProps && (index == "message" || index == "name"))');
            }

            if (obj.useHas && obj.keys) {
                __p += '\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n';
                if (conditions.length) {
                    __p += '    if (' +
                        (conditions.join(' && ')) +
                        ') {\n  ';
                }
                __p +=
                    (obj.loop) +
                    ';    ';
                if (conditions.length) {
                    __p += '\n    }';
                }
                __p += '\n  }  ';
            } else {
                __p += '\n  for (index in iterable) {\n';
                if (obj.useHas) {
                    conditions.push("hasOwnProperty.call(iterable, index)");
                }
                if (conditions.length) {
                    __p += '    if (' +
                        (conditions.join(' && ')) +
                        ') {\n  ';
                }
                __p +=
                    (obj.loop) +
                    ';    ';
                if (conditions.length) {
                    __p += '\n    }';
                }
                __p += '\n  }    ';
                if (support.nonEnumShadows) {
                    __p += '\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ';
                    for (k = 0; k < 7; k++) {
                        __p += '\n    index = \'' +
                            (obj.shadowedProps[k]) +
                            '\';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))';
                        if (!obj.useHas) {
                            __p += ' || (!nonEnum[index] && iterable[index] !== objectProto[index])';
                        }
                        __p += ') {\n      ' +
                            (obj.loop) +
                            ';\n    }      ';
                    }
                    __p += '\n  }    ';
                }

            }

            if (obj.array || support.nonEnumArgs) {
                __p += '\n}';
            }
            __p +=
                (obj.bottom) +
                ';\nreturn result';

            return __p
        };

        /*--------------------------------------------------------------------------*/

        /**
         * The base implementation of `_.bind` that creates the bound function and
         * sets its meta data.
         *
         * @private
         * @param {Array} bindData The bind data array.
         * @returns {Function} Returns the new bound function.
         */
        function baseBind(bindData) {
            var func = bindData[0],
                partialArgs = bindData[2],
                thisArg = bindData[4];

            function bound() {
                // `Function#bind` spec
                // http://es5.github.io/#x15.3.4.5
                if (partialArgs) {
                    // avoid `arguments` object deoptimizations by using `slice` instead
                    // of `Array.prototype.slice.call` and not assigning `arguments` to a
                    // variable as a ternary expression
                    var args = slice(partialArgs);
                    push.apply(args, arguments);
                }
                // mimic the constructor's `return` behavior
                // http://es5.github.io/#x13.2.2
                if (this instanceof bound) {
                    // ensure `new bound` is an instance of `func`
                    var thisBinding = baseCreate(func.prototype),
                        result = func.apply(thisBinding, args || arguments);
                    return isObject(result) ? result : thisBinding;
                }
                return func.apply(thisArg, args || arguments);
            }

            setBindData(bound, bindData);
            return bound;
        }

        /**
         * The base implementation of `_.clone` without argument juggling or support
         * for `thisArg` binding.
         *
         * @private
         * @param {*} value The value to clone.
         * @param {boolean} [isDeep=false] Specify a deep clone.
         * @param {Function} [callback] The function to customize cloning values.
         * @param {Array} [stackA=[]] Tracks traversed source objects.
         * @param {Array} [stackB=[]] Associates clones with source counterparts.
         * @returns {*} Returns the cloned value.
         */
        function baseClone(value, isDeep, callback, stackA, stackB) {
            if (callback) {
                var result = callback(value);
                if (typeof result != 'undefined') {
                    return result;
                }
            }
            // inspect [[Class]]
            var isObj = isObject(value);
            if (isObj) {
                var className = toString.call(value);
                if (!cloneableClasses[className] || (!support.nodeClass && isNode(value))) {
                    return value;
                }
                var ctor = ctorByClass[className];
                switch (className) {
                    case boolClass:
                    case dateClass:
                        return new ctor(+value);

                    case numberClass:
                    case stringClass:
                        return new ctor(value);

                    case regexpClass:
                        result = ctor(value.source, reFlags.exec(value));
                        result.lastIndex = value.lastIndex;
                        return result;
                }
            } else {
                return value;
            }
            var isArr = isArray(value);
            if (isDeep) {
                // check for circular references and return corresponding clone
                var initedStack = !stackA;
                stackA || (stackA = getArray());
                stackB || (stackB = getArray());

                var length = stackA.length;
                while (length--) {
                    if (stackA[length] == value) {
                        return stackB[length];
                    }
                }
                result = isArr ? ctor(value.length) : {};
            }
            else {
                result = isArr ? slice(value) : assign({}, value);
            }
            // add array properties assigned by `RegExp#exec`
            if (isArr) {
                if (hasOwnProperty.call(value, 'index')) {
                    result.index = value.index;
                }
                if (hasOwnProperty.call(value, 'input')) {
                    result.input = value.input;
                }
            }
            // exit for shallow clone
            if (!isDeep) {
                return result;
            }
            // add the source value to the stack of traversed objects
            // and associate it with its clone
            stackA.push(value);
            stackB.push(result);

            // recursively populate clone (susceptible to call stack limits)
            (isArr ? baseEach : forOwn)(value, function (objValue, key) {
                result[key] = baseClone(objValue, isDeep, callback, stackA, stackB);
            });

            if (initedStack) {
                releaseArray(stackA);
                releaseArray(stackB);
            }
            return result;
        }

        /**
         * The base implementation of `_.create` without support for assigning
         * properties to the created object.
         *
         * @private
         * @param {Object} prototype The object to inherit from.
         * @returns {Object} Returns the new object.
         */
        function baseCreate(prototype, properties) {
            return isObject(prototype) ? nativeCreate(prototype) : {};
        }

        // fallback for browsers without `Object.create`
        if (!nativeCreate) {
            baseCreate = (function () {
                function Object() {
                }

                return function (prototype) {
                    if (isObject(prototype)) {
                        Object.prototype = prototype;
                        var result = new Object;
                        Object.prototype = null;
                    }
                    return result || root.Object();
                };
            }());
        }

        /**
         * The base implementation of `_.createCallback` without support for creating
         * "_.pluck" or "_.where" style callbacks.
         *
         * @private
         * @param {*} [func=identity] The value to convert to a callback.
         * @param {*} [thisArg] The `this` binding of the created callback.
         * @param {number} [argCount] The number of arguments the callback accepts.
         * @returns {Function} Returns a callback function.
         */
        function baseCreateCallback(func, thisArg, argCount) {
            if (typeof func != 'function') {
                return identity;
            }
            // exit early for no `thisArg` or already bound by `Function#bind`
            if (typeof thisArg == 'undefined' || !('prototype' in func)) {
                return func;
            }
            var bindData = func.__bindData__;
            if (typeof bindData == 'undefined') {
                if (support.funcNames) {
                    bindData = !func.name;
                }
                bindData = bindData || !support.funcDecomp;
                if (!bindData) {
                    var source = fnToString.call(func);
                    if (!support.funcNames) {
                        bindData = !reFuncName.test(source);
                    }
                    if (!bindData) {
                        // checks if `func` references the `this` keyword and stores the result
                        bindData = reThis.test(source);
                        setBindData(func, bindData);
                    }
                }
            }
            // exit early if there are no `this` references or `func` is bound
            if (bindData === false || (bindData !== true && bindData[1] & 1)) {
                return func;
            }
            switch (argCount) {
                case 1:
                    return function (value) {
                        return func.call(thisArg, value);
                    };
                case 2:
                    return function (a, b) {
                        return func.call(thisArg, a, b);
                    };
                case 3:
                    return function (value, index, collection) {
                        return func.call(thisArg, value, index, collection);
                    };
                case 4:
                    return function (accumulator, value, index, collection) {
                        return func.call(thisArg, accumulator, value, index, collection);
                    };
            }
            return bind(func, thisArg);
        }

        /**
         * The base implementation of `createWrapper` that creates the wrapper and
         * sets its meta data.
         *
         * @private
         * @param {Array} bindData The bind data array.
         * @returns {Function} Returns the new function.
         */
        function baseCreateWrapper(bindData) {
            var func = bindData[0],
                bitmask = bindData[1],
                partialArgs = bindData[2],
                partialRightArgs = bindData[3],
                thisArg = bindData[4],
                arity = bindData[5];

            var isBind = bitmask & 1,
                isBindKey = bitmask & 2,
                isCurry = bitmask & 4,
                isCurryBound = bitmask & 8,
                key = func;

            function bound() {
                var thisBinding = isBind ? thisArg : this;
                if (partialArgs) {
                    var args = slice(partialArgs);
                    push.apply(args, arguments);
                }
                if (partialRightArgs || isCurry) {
                    args || (args = slice(arguments));
                    if (partialRightArgs) {
                        push.apply(args, partialRightArgs);
                    }
                    if (isCurry && args.length < arity) {
                        bitmask |= 16 & ~32;
                        return baseCreateWrapper([func, (isCurryBound ? bitmask : bitmask & ~3), args, null, thisArg, arity]);
                    }
                }
                args || (args = arguments);
                if (isBindKey) {
                    func = thisBinding[key];
                }
                if (this instanceof bound) {
                    thisBinding = baseCreate(func.prototype);
                    var result = func.apply(thisBinding, args);
                    return isObject(result) ? result : thisBinding;
                }
                return func.apply(thisBinding, args);
            }

            setBindData(bound, bindData);
            return bound;
        }

        /**
         * The base implementation of `_.isEqual`, without support for `thisArg` binding,
         * that allows partial "_.where" style comparisons.
         *
         * @private
         * @param {*} a The value to compare.
         * @param {*} b The other value to compare.
         * @param {Function} [callback] The function to customize comparing values.
         * @param {Function} [isWhere=false] A flag to indicate performing partial comparisons.
         * @param {Array} [stackA=[]] Tracks traversed `a` objects.
         * @param {Array} [stackB=[]] Tracks traversed `b` objects.
         * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
         */
        function baseIsEqual(a, b, callback, isWhere, stackA, stackB) {
            // used to indicate that when comparing objects, `a` has at least the properties of `b`
            if (callback) {
                var result = callback(a, b);
                if (typeof result != 'undefined') {
                    return !!result;
                }
            }
            // exit early for identical values
            if (a === b) {
                // treat `+0` vs. `-0` as not equal
                return a !== 0 || (1 / a == 1 / b);
            }
            var type = typeof a,
                otherType = typeof b;

            // exit early for unlike primitive values
            if (a === a && !(a && objectTypes[type]) && !(b && objectTypes[otherType])) {
                return false;
            }
            // exit early for `null` and `undefined` avoiding ES3's Function#call behavior
            // http://es5.github.io/#x15.3.4.4
            if (a == null || b == null) {
                return a === b;
            }
            // compare [[Class]] names
            var className = toString.call(a),
                otherClass = toString.call(b);

            if (className == argsClass) {
                className = objectClass;
            }
            if (otherClass == argsClass) {
                otherClass = objectClass;
            }
            if (className != otherClass) {
                return false;
            }
            switch (className) {
                case boolClass:
                case dateClass:
                    // coerce dates and booleans to numbers, dates to milliseconds and booleans
                    // to `1` or `0` treating invalid dates coerced to `NaN` as not equal
                    return +a == +b;

                case numberClass:
                    // treat `NaN` vs. `NaN` as equal
                    return (a != +a)
                        ? b != +b
                        // but treat `+0` vs. `-0` as not equal
                        : (a == 0 ? (1 / a == 1 / b) : a == +b);

                case regexpClass:
                case stringClass:
                    // coerce regexes to strings (http://es5.github.io/#x15.10.6.4)
                    // treat string primitives and their corresponding object instances as equal
                    return a == String(b);
            }
            var isArr = className == arrayClass;
            if (!isArr) {
                // unwrap any `lodash` wrapped values
                var aWrapped = hasOwnProperty.call(a, '__wrapped__'),
                    bWrapped = hasOwnProperty.call(b, '__wrapped__');

                if (aWrapped || bWrapped) {
                    return baseIsEqual(aWrapped ? a.__wrapped__ : a, bWrapped ? b.__wrapped__ : b, callback, isWhere, stackA, stackB);
                }
                // exit for functions and DOM nodes
                if (className != objectClass || (!support.nodeClass && (isNode(a) || isNode(b)))) {
                    return false;
                }
                // in older versions of Opera, `arguments` objects have `Array` constructors
                var ctorA = !support.argsObject && isArguments(a) ? Object : a.constructor,
                    ctorB = !support.argsObject && isArguments(b) ? Object : b.constructor;

                // non `Object` object instances with different constructors are not equal
                if (ctorA != ctorB && !(isFunction(ctorA) && ctorA instanceof ctorA && isFunction(ctorB) && ctorB instanceof ctorB) &&
                    ('constructor' in a && 'constructor' in b)
                ) {
                    return false;
                }
            }
            // assume cyclic structures are equal
            // the algorithm for detecting cyclic structures is adapted from ES 5.1
            // section 15.12.3, abstract operation `JO` (http://es5.github.io/#x15.12.3)
            var initedStack = !stackA;
            stackA || (stackA = getArray());
            stackB || (stackB = getArray());

            var length = stackA.length;
            while (length--) {
                if (stackA[length] == a) {
                    return stackB[length] == b;
                }
            }
            var size = 0;
            result = true;

            // add `a` and `b` to the stack of traversed objects
            stackA.push(a);
            stackB.push(b);

            // recursively compare objects and arrays (susceptible to call stack limits)
            if (isArr) {
                // compare lengths to determine if a deep comparison is necessary
                length = a.length;
                size = b.length;
                result = size == length;

                if (result || isWhere) {
                    // deep compare the contents, ignoring non-numeric properties
                    while (size--) {
                        var index = length,
                            value = b[size];

                        if (isWhere) {
                            while (index--) {
                                if ((result = baseIsEqual(a[index], value, callback, isWhere, stackA, stackB))) {
                                    break;
                                }
                            }
                        } else if (!(result = baseIsEqual(a[size], value, callback, isWhere, stackA, stackB))) {
                            break;
                        }
                    }
                }
            }
            else {
                // deep compare objects using `forIn`, instead of `forOwn`, to avoid `Object.keys`
                // which, in this case, is more costly
                forIn(b, function (value, key, b) {
                    if (hasOwnProperty.call(b, key)) {
                        // count the number of properties.
                        size++;
                        // deep compare each property value.
                        return (result = hasOwnProperty.call(a, key) && baseIsEqual(a[key], value, callback, isWhere, stackA, stackB));
                    }
                });

                if (result && !isWhere) {
                    // ensure both objects have the same number of properties
                    forIn(a, function (value, key, a) {
                        if (hasOwnProperty.call(a, key)) {
                            // `size` will be `-1` if `a` has more properties than `b`
                            return (result = --size > -1);
                        }
                    });
                }
            }
            stackA.pop();
            stackB.pop();

            if (initedStack) {
                releaseArray(stackA);
                releaseArray(stackB);
            }
            return result;
        }

        /**
         * Creates a function that, when called, either curries or invokes `func`
         * with an optional `this` binding and partially applied arguments.
         *
         * @private
         * @param {Function|string} func The function or method name to reference.
         * @param {number} bitmask The bitmask of method flags to compose.
         *  The bitmask may be composed of the following flags:
         *  1 - `_.bind`
         *  2 - `_.bindKey`
         *  4 - `_.curry`
         *  8 - `_.curry` (bound)
         *  16 - `_.partial`
         *  32 - `_.partialRight`
         * @param {Array} [partialArgs] An array of arguments to prepend to those
         *  provided to the new function.
         * @param {Array} [partialRightArgs] An array of arguments to append to those
         *  provided to the new function.
         * @param {*} [thisArg] The `this` binding of `func`.
         * @param {number} [arity] The arity of `func`.
         * @returns {Function} Returns the new function.
         */
        function createWrapper(func, bitmask, partialArgs, partialRightArgs, thisArg, arity) {
            var isBind = bitmask & 1,
                isBindKey = bitmask & 2,
                isCurry = bitmask & 4,
                isCurryBound = bitmask & 8,
                isPartial = bitmask & 16,
                isPartialRight = bitmask & 32;

            if (!isBindKey && !isFunction(func)) {
                throw new TypeError;
            }
            if (isPartial && !partialArgs.length) {
                bitmask &= ~16;
                isPartial = partialArgs = false;
            }
            if (isPartialRight && !partialRightArgs.length) {
                bitmask &= ~32;
                isPartialRight = partialRightArgs = false;
            }
            var bindData = func && func.__bindData__;
            if (bindData && bindData !== true) {
                // clone `bindData`
                bindData = slice(bindData);
                if (bindData[2]) {
                    bindData[2] = slice(bindData[2]);
                }
                if (bindData[3]) {
                    bindData[3] = slice(bindData[3]);
                }
                // set `thisBinding` is not previously bound
                if (isBind && !(bindData[1] & 1)) {
                    bindData[4] = thisArg;
                }
                // set if previously bound but not currently (subsequent curried functions)
                if (!isBind && bindData[1] & 1) {
                    bitmask |= 8;
                }
                // set curried arity if not yet set
                if (isCurry && !(bindData[1] & 4)) {
                    bindData[5] = arity;
                }
                // append partial left arguments
                if (isPartial) {
                    push.apply(bindData[2] || (bindData[2] = []), partialArgs);
                }
                // append partial right arguments
                if (isPartialRight) {
                    unshift.apply(bindData[3] || (bindData[3] = []), partialRightArgs);
                }
                // merge flags
                bindData[1] |= bitmask;
                return createWrapper.apply(null, bindData);
            }
            // fast path for `_.bind`
            var creater = (bitmask == 1 || bitmask === 17) ? baseBind : baseCreateWrapper;
            return creater([func, bitmask, partialArgs, partialRightArgs, thisArg, arity]);
        }

        /**
         * Creates compiled iteration functions.
         *
         * @private
         * @param {...Object} [options] The compile options object(s).
         * @param {string} [options.array] Code to determine if the iterable is an array or array-like.
         * @param {boolean} [options.useHas] Specify using `hasOwnProperty` checks in the object loop.
         * @param {Function} [options.keys] A reference to `_.keys` for use in own property iteration.
         * @param {string} [options.args] A comma separated string of iteration function arguments.
         * @param {string} [options.top] Code to execute before the iteration branches.
         * @param {string} [options.loop] Code to execute in the object loop.
         * @param {string} [options.bottom] Code to execute after the iteration branches.
         * @returns {Function} Returns the compiled function.
         */
        function createIterator() {
            // data properties
            iteratorData.shadowedProps = shadowedProps;

            // iterator options
            iteratorData.array = iteratorData.bottom = iteratorData.loop = iteratorData.top = '';
            iteratorData.init = 'iterable';
            iteratorData.useHas = true;

            // merge options into a template data object
            for (var object, index = 0; object = arguments[index]; index++) {
                for (var key in object) {
                    iteratorData[key] = object[key];
                }
            }
            var args = iteratorData.args;
            iteratorData.firstArg = /^[^,]+/.exec(args)[0];

            // create the function factory
            var factory = Function(
                'baseCreateCallback, errorClass, errorProto, hasOwnProperty, ' +
                'indicatorObject, isArguments, isArray, isString, keys, objectProto, ' +
                'objectTypes, nonEnumProps, stringClass, stringProto, toString',
                'return function(' + args + ') {\n' + iteratorTemplate(iteratorData) + '\n}'
            );

            // return the compiled function
            return factory(
                baseCreateCallback, errorClass, errorProto, hasOwnProperty,
                indicatorObject, isArguments, isArray, isString, iteratorData.keys, objectProto,
                objectTypes, nonEnumProps, stringClass, stringProto, toString
            );
        }

        /**
         * Used by `escape` to convert characters to HTML entities.
         *
         * @private
         * @param {string} match The matched character to escape.
         * @returns {string} Returns the escaped character.
         */
        function escapeHtmlChar(match) {
            return htmlEscapes[match];
        }

        /**
         * Checks if `value` is a native function.
         *
         * @private
         * @param {*} value The value to check.
         * @returns {boolean} Returns `true` if the `value` is a native function, else `false`.
         */
        function isNative(value) {
            return typeof value == 'function' && reNative.test(value);
        }

        /**
         * Sets `this` binding data on a given function.
         *
         * @private
         * @param {Function} func The function to set data on.
         * @param {Array} value The data array to set.
         */
        var setBindData = !defineProperty ? noop : function (func, value) {
            descriptor.value = value;
            defineProperty(func, '__bindData__', descriptor);
        };

        /*--------------------------------------------------------------------------*/

        /**
         * Checks if `value` is an `arguments` object.
         *
         * @static
         * @memberOf _
         * @category Objects
         * @param {*} value The value to check.
         * @returns {boolean} Returns `true` if the `value` is an `arguments` object, else `false`.
         * @example
         *
         * (function() { return _.isArguments(arguments); })(1, 2, 3);
         * // => true
         *
         * _.isArguments([1, 2, 3]);
         * // => false
         */
        function isArguments(value) {
            return value && typeof value == 'object' && typeof value.length == 'number' &&
                toString.call(value) == argsClass || false;
        }

        // fallback for browsers that can't detect `arguments` objects by [[Class]]
        if (!support.argsClass) {
            isArguments = function (value) {
                return value && typeof value == 'object' && typeof value.length == 'number' &&
                    hasOwnProperty.call(value, 'callee') && !propertyIsEnumerable.call(value, 'callee') || false;
            };
        }

        /**
         * Checks if `value` is an array.
         *
         * @static
         * @memberOf _
         * @type Function
         * @category Objects
         * @param {*} value The value to check.
         * @returns {boolean} Returns `true` if the `value` is an array, else `false`.
         * @example
         *
         * (function() { return _.isArray(arguments); })();
         * // => false
         *
         * _.isArray([1, 2, 3]);
         * // => true
         */
        var isArray = nativeIsArray || function (value) {
                return value && typeof value == 'object' && typeof value.length == 'number' &&
                    toString.call(value) == arrayClass || false;
            };

        /**
         * A fallback implementation of `Object.keys` which produces an array of the
         * given object's own enumerable property names.
         *
         * @private
         * @type Function
         * @param {Object} object The object to inspect.
         * @returns {Array} Returns an array of property names.
         */
        var shimKeys = createIterator({
            'args': 'object',
            'init': '[]',
            'top': 'if (!(objectTypes[typeof object])) return result',
            'loop': 'result.push(index)'
        });

        /**
         * Creates an array composed of the own enumerable property names of an object.
         *
         * @static
         * @memberOf _
         * @category Objects
         * @param {Object} object The object to inspect.
         * @returns {Array} Returns an array of property names.
         * @example
         *
         * _.keys({ 'one': 1, 'two': 2, 'three': 3 });
         * // => ['one', 'two', 'three'] (property order is not guaranteed across environments)
         */
        var keys = !nativeKeys ? shimKeys : function (object) {
            if (!isObject(object)) {
                return [];
            }
            if ((support.enumPrototypes && typeof object == 'function') ||
                (support.nonEnumArgs && object.length && isArguments(object))) {
                return shimKeys(object);
            }
            return nativeKeys(object);
        };

        /** Reusable iterator options shared by `each`, `forIn`, and `forOwn` */
        var eachIteratorOptions = {
            'args': 'collection, callback, thisArg',
            'top': "callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3)",
            'array': "typeof length == 'number'",
            'keys': keys,
            'loop': 'if (callback(iterable[index], index, collection) === false) return result'
        };

        /** Reusable iterator options for `assign` and `defaults` */
        var defaultsIteratorOptions = {
            'args': 'object, source, guard',
            'top': 'var args = arguments,\n' +
            '    argsIndex = 0,\n' +
            "    argsLength = typeof guard == 'number' ? 2 : args.length;\n" +
            'while (++argsIndex < argsLength) {\n' +
            '  iterable = args[argsIndex];\n' +
            '  if (iterable && objectTypes[typeof iterable]) {',
            'keys': keys,
            'loop': "if (typeof result[index] == 'undefined') result[index] = iterable[index]",
            'bottom': '  }\n}'
        };

        /** Reusable iterator options for `forIn` and `forOwn` */
        var forOwnIteratorOptions = {
            'top': 'if (!objectTypes[typeof iterable]) return result;\n' + eachIteratorOptions.top,
            'array': false
        };

        /**
         * Used to convert characters to HTML entities:
         *
         * Though the `>` character is escaped for symmetry, characters like `>` and `/`
         * don't require escaping in HTML and have no special meaning unless they're part
         * of a tag or an unquoted attribute value.
         * http://mathiasbynens.be/notes/ambiguous-ampersands (under "semi-related fun fact")
         */
        var htmlEscapes = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#39;'
        };

        /** Used to match HTML entities and HTML characters */
        var reUnescapedHtml = RegExp('[' + keys(htmlEscapes).join('') + ']', 'g');

        /**
         * A function compiled to iterate `arguments` objects, arrays, objects, and
         * strings consistenly across environments, executing the callback for each
         * element in the collection. The callback is bound to `thisArg` and invoked
         * with three arguments; (value, index|key, collection). Callbacks may exit
         * iteration early by explicitly returning `false`.
         *
         * @private
         * @type Function
         * @param {Array|Object|string} collection The collection to iterate over.
         * @param {Function} [callback=identity] The function called per iteration.
         * @param {*} [thisArg] The `this` binding of `callback`.
         * @returns {Array|Object|string} Returns `collection`.
         */
        var baseEach = createIterator(eachIteratorOptions);

        /*--------------------------------------------------------------------------*/

        /**
         * Assigns own enumerable properties of source object(s) to the destination
         * object. Subsequent sources will overwrite property assignments of previous
         * sources. If a callback is provided it will be executed to produce the
         * assigned values. The callback is bound to `thisArg` and invoked with two
         * arguments; (objectValue, sourceValue).
         *
         * @static
         * @memberOf _
         * @type Function
         * @alias extend
         * @category Objects
         * @param {Object} object The destination object.
         * @param {...Object} [source] The source objects.
         * @param {Function} [callback] The function to customize assigning values.
         * @param {*} [thisArg] The `this` binding of `callback`.
         * @returns {Object} Returns the destination object.
         * @example
         *
         * _.assign({ 'name': 'fred' }, { 'employer': 'slate' });
         * // => { 'name': 'fred', 'employer': 'slate' }
         *
         * var defaults = _.partialRight(_.assign, function(a, b) {
   *   return typeof a == 'undefined' ? b : a;
   * });
         *
         * var object = { 'name': 'barney' };
         * defaults(object, { 'name': 'fred', 'employer': 'slate' });
         * // => { 'name': 'barney', 'employer': 'slate' }
         */
        var assign = createIterator(defaultsIteratorOptions, {
            'top': defaultsIteratorOptions.top.replace(';',
                ';\n' +
                "if (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n" +
                '  var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);\n' +
                "} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n" +
                '  callback = args[--argsLength];\n' +
                '}'
            ),
            'loop': 'result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]'
        });

        /**
         * Creates a clone of `value`. If `isDeep` is `true` nested objects will also
         * be cloned, otherwise they will be assigned by reference. If a callback
         * is provided it will be executed to produce the cloned values. If the
         * callback returns `undefined` cloning will be handled by the method instead.
         * The callback is bound to `thisArg` and invoked with one argument; (value).
         *
         * @static
         * @memberOf _
         * @category Objects
         * @param {*} value The value to clone.
         * @param {boolean} [isDeep=false] Specify a deep clone.
         * @param {Function} [callback] The function to customize cloning values.
         * @param {*} [thisArg] The `this` binding of `callback`.
         * @returns {*} Returns the cloned value.
         * @example
         *
         * var characters = [
         *   { 'name': 'barney', 'age': 36 },
         *   { 'name': 'fred',   'age': 40 }
         * ];
         *
         * var shallow = _.clone(characters);
         * shallow[0] === characters[0];
         * // => true
         *
         * var deep = _.clone(characters, true);
         * deep[0] === characters[0];
         * // => false
         *
         * _.mixin({
   *   'clone': _.partialRight(_.clone, function(value) {
   *     return _.isElement(value) ? value.cloneNode(false) : undefined;
   *   })
   * });
         *
         * var clone = _.clone(document.body);
         * clone.childNodes.length;
         * // => 0
         */
        function clone(value, isDeep, callback, thisArg) {
            // allows working with "Collections" methods without using their `index`
            // and `collection` arguments for `isDeep` and `callback`
            if (typeof isDeep != 'boolean' && isDeep != null) {
                thisArg = callback;
                callback = isDeep;
                isDeep = false;
            }
            return baseClone(value, isDeep, typeof callback == 'function' && baseCreateCallback(callback, thisArg, 1));
        }

        /**
         * Creates a deep clone of `value`. If a callback is provided it will be
         * executed to produce the cloned values. If the callback returns `undefined`
         * cloning will be handled by the method instead. The callback is bound to
         * `thisArg` and invoked with one argument; (value).
         *
         * Note: This method is loosely based on the structured clone algorithm. Functions
         * and DOM nodes are **not** cloned. The enumerable properties of `arguments` objects and
         * objects created by constructors other than `Object` are cloned to plain `Object` objects.
         * See http://www.w3.org/TR/html5/infrastructure.html#internal-structured-cloning-algorithm.
         *
         * @static
         * @memberOf _
         * @category Objects
         * @param {*} value The value to deep clone.
         * @param {Function} [callback] The function to customize cloning values.
         * @param {*} [thisArg] The `this` binding of `callback`.
         * @returns {*} Returns the deep cloned value.
         * @example
         *
         * var characters = [
         *   { 'name': 'barney', 'age': 36 },
         *   { 'name': 'fred',   'age': 40 }
         * ];
         *
         * var deep = _.cloneDeep(characters);
         * deep[0] === characters[0];
         * // => false
         *
         * var view = {
   *   'label': 'docs',
   *   'node': element
   * };
         *
         * var clone = _.cloneDeep(view, function(value) {
   *   return _.isElement(value) ? value.cloneNode(true) : undefined;
   * });
         *
         * clone.node == view.node;
         * // => false
         */
        function cloneDeep(value, callback, thisArg) {
            return baseClone(value, true, typeof callback == 'function' && baseCreateCallback(callback, thisArg, 1));
        }

        /**
         * Assigns own enumerable properties of source object(s) to the destination
         * object for all destination properties that resolve to `undefined`. Once a
         * property is set, additional defaults of the same property will be ignored.
         *
         * @static
         * @memberOf _
         * @type Function
         * @category Objects
         * @param {Object} object The destination object.
         * @param {...Object} [source] The source objects.
         * @param- {Object} [guard] Allows working with `_.reduce` without using its
         *  `key` and `object` arguments as sources.
         * @returns {Object} Returns the destination object.
         * @example
         *
         * var object = { 'name': 'barney' };
         * _.defaults(object, { 'name': 'fred', 'employer': 'slate' });
         * // => { 'name': 'barney', 'employer': 'slate' }
         */
        var defaults = createIterator(defaultsIteratorOptions);

        /**
         * Iterates over own and inherited enumerable properties of an object,
         * executing the callback for each property. The callback is bound to `thisArg`
         * and invoked with three arguments; (value, key, object). Callbacks may exit
         * iteration early by explicitly returning `false`.
         *
         * @static
         * @memberOf _
         * @type Function
         * @category Objects
         * @param {Object} object The object to iterate over.
         * @param {Function} [callback=identity] The function called per iteration.
         * @param {*} [thisArg] The `this` binding of `callback`.
         * @returns {Object} Returns `object`.
         * @example
         *
         * function Shape() {
   *   this.x = 0;
   *   this.y = 0;
   * }
         *
         * Shape.prototype.move = function(x, y) {
   *   this.x += x;
   *   this.y += y;
   * };
         *
         * _.forIn(new Shape, function(value, key) {
   *   console.log(key);
   * });
         * // => logs 'x', 'y', and 'move' (property order is not guaranteed across environments)
         */
        var forIn = createIterator(eachIteratorOptions, forOwnIteratorOptions, {
            'useHas': false
        });

        /**
         * Iterates over own enumerable properties of an object, executing the callback
         * for each property. The callback is bound to `thisArg` and invoked with three
         * arguments; (value, key, object). Callbacks may exit iteration early by
         * explicitly returning `false`.
         *
         * @static
         * @memberOf _
         * @type Function
         * @category Objects
         * @param {Object} object The object to iterate over.
         * @param {Function} [callback=identity] The function called per iteration.
         * @param {*} [thisArg] The `this` binding of `callback`.
         * @returns {Object} Returns `object`.
         * @example
         *
         * _.forOwn({ '0': 'zero', '1': 'one', 'length': 2 }, function(num, key) {
   *   console.log(key);
   * });
         * // => logs '0', '1', and 'length' (property order is not guaranteed across environments)
         */
        var forOwn = createIterator(eachIteratorOptions, forOwnIteratorOptions);

        /**
         * Checks if `value` is a function.
         *
         * @static
         * @memberOf _
         * @category Objects
         * @param {*} value The value to check.
         * @returns {boolean} Returns `true` if the `value` is a function, else `false`.
         * @example
         *
         * _.isFunction(_);
         * // => true
         */
        function isFunction(value) {
            return typeof value == 'function';
        }

        // fallback for older versions of Chrome and Safari
        if (isFunction(/x/)) {
            isFunction = function (value) {
                return typeof value == 'function' && toString.call(value) == funcClass;
            };
        }

        /**
         * Checks if `value` is the language type of Object.
         * (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
         *
         * @static
         * @memberOf _
         * @category Objects
         * @param {*} value The value to check.
         * @returns {boolean} Returns `true` if the `value` is an object, else `false`.
         * @example
         *
         * _.isObject({});
         * // => true
         *
         * _.isObject([1, 2, 3]);
         * // => true
         *
         * _.isObject(1);
         * // => false
         */
        function isObject(value) {
            // check if the value is the ECMAScript language type of Object
            // http://es5.github.io/#x8
            // and avoid a V8 bug
            // http://code.google.com/p/v8/issues/detail?id=2291
            return !!(value && objectTypes[typeof value]);
        }

        /**
         * Checks if `value` is a string.
         *
         * @static
         * @memberOf _
         * @category Objects
         * @param {*} value The value to check.
         * @returns {boolean} Returns `true` if the `value` is a string, else `false`.
         * @example
         *
         * _.isString('fred');
         * // => true
         */
        function isString(value) {
            return typeof value == 'string' ||
                value && typeof value == 'object' && toString.call(value) == stringClass || false;
        }

        /**
         * Creates an array composed of the own enumerable property values of `object`.
         *
         * @static
         * @memberOf _
         * @category Objects
         * @param {Object} object The object to inspect.
         * @returns {Array} Returns an array of property values.
         * @example
         *
         * _.values({ 'one': 1, 'two': 2, 'three': 3 });
         * // => [1, 2, 3] (property order is not guaranteed across environments)
         */
        function values(object) {
            var index = -1,
                props = keys(object),
                length = props.length,
                result = Array(length);

            while (++index < length) {
                result[index] = object[props[index]];
            }
            return result;
        }

        /*--------------------------------------------------------------------------*/

        /**
         * Iterates over elements of a collection, returning an array of all elements
         * the callback returns truey for. The callback is bound to `thisArg` and
         * invoked with three arguments; (value, index|key, collection).
         *
         * If a property name is provided for `callback` the created "_.pluck" style
         * callback will return the property value of the given element.
         *
         * If an object is provided for `callback` the created "_.where" style callback
         * will return `true` for elements that have the properties of the given object,
         * else `false`.
         *
         * @static
         * @memberOf _
         * @alias select
         * @category Collections
         * @param {Array|Object|string} collection The collection to iterate over.
         * @param {Function|Object|string} [callback=identity] The function called
         *  per iteration. If a property name or object is provided it will be used
         *  to create a "_.pluck" or "_.where" style callback, respectively.
         * @param {*} [thisArg] The `this` binding of `callback`.
         * @returns {Array} Returns a new array of elements that passed the callback check.
         * @example
         *
         * var evens = _.filter([1, 2, 3, 4, 5, 6], function(num) { return num % 2 == 0; });
         * // => [2, 4, 6]
         *
         * var characters = [
         *   { 'name': 'barney', 'age': 36, 'blocked': false },
         *   { 'name': 'fred',   'age': 40, 'blocked': true }
         * ];
         *
         * // using "_.pluck" callback shorthand
         * _.filter(characters, 'blocked');
         * // => [{ 'name': 'fred', 'age': 40, 'blocked': true }]
         *
         * // using "_.where" callback shorthand
         * _.filter(characters, { 'age': 36 });
         * // => [{ 'name': 'barney', 'age': 36, 'blocked': false }]
         */
        function filter(collection, callback, thisArg) {
            var result = [];
            callback = lodash.createCallback(callback, thisArg, 3);

            if (isArray(collection)) {
                var index = -1,
                    length = collection.length;

                while (++index < length) {
                    var value = collection[index];
                    if (callback(value, index, collection)) {
                        result.push(value);
                    }
                }
            } else {
                baseEach(collection, function (value, index, collection) {
                    if (callback(value, index, collection)) {
                        result.push(value);
                    }
                });
            }
            return result;
        }

        /**
         * Iterates over elements of a collection, returning the first element that
         * the callback returns truey for. The callback is bound to `thisArg` and
         * invoked with three arguments; (value, index|key, collection).
         *
         * If a property name is provided for `callback` the created "_.pluck" style
         * callback will return the property value of the given element.
         *
         * If an object is provided for `callback` the created "_.where" style callback
         * will return `true` for elements that have the properties of the given object,
         * else `false`.
         *
         * @static
         * @memberOf _
         * @alias detect, findWhere
         * @category Collections
         * @param {Array|Object|string} collection The collection to iterate over.
         * @param {Function|Object|string} [callback=identity] The function called
         *  per iteration. If a property name or object is provided it will be used
         *  to create a "_.pluck" or "_.where" style callback, respectively.
         * @param {*} [thisArg] The `this` binding of `callback`.
         * @returns {*} Returns the found element, else `undefined`.
         * @example
         *
         * var characters = [
         *   { 'name': 'barney',  'age': 36, 'blocked': false },
         *   { 'name': 'fred',    'age': 40, 'blocked': true },
         *   { 'name': 'pebbles', 'age': 1,  'blocked': false }
         * ];
         *
         * _.find(characters, function(chr) {
   *   return chr.age < 40;
   * });
         * // => { 'name': 'barney', 'age': 36, 'blocked': false }
         *
         * // using "_.where" callback shorthand
         * _.find(characters, { 'age': 1 });
         * // =>  { 'name': 'pebbles', 'age': 1, 'blocked': false }
         *
         * // using "_.pluck" callback shorthand
         * _.find(characters, 'blocked');
         * // => { 'name': 'fred', 'age': 40, 'blocked': true }
         */
        function find(collection, callback, thisArg) {
            callback = lodash.createCallback(callback, thisArg, 3);

            if (isArray(collection)) {
                var index = -1,
                    length = collection.length;

                while (++index < length) {
                    var value = collection[index];
                    if (callback(value, index, collection)) {
                        return value;
                    }
                }
            } else {
                var result;
                baseEach(collection, function (value, index, collection) {
                    if (callback(value, index, collection)) {
                        result = value;
                        return false;
                    }
                });
                return result;
            }
        }

        /**
         * Iterates over elements of a collection, executing the callback for each
         * element. The callback is bound to `thisArg` and invoked with three arguments;
         * (value, index|key, collection). Callbacks may exit iteration early by
         * explicitly returning `false`.
         *
         * Note: As with other "Collections" methods, objects with a `length` property
         * are iterated like arrays. To avoid this behavior `_.forIn` or `_.forOwn`
         * may be used for object iteration.
         *
         * @static
         * @memberOf _
         * @alias each
         * @category Collections
         * @param {Array|Object|string} collection The collection to iterate over.
         * @param {Function} [callback=identity] The function called per iteration.
         * @param {*} [thisArg] The `this` binding of `callback`.
         * @returns {Array|Object|string} Returns `collection`.
         * @example
         *
         * _([1, 2, 3]).forEach(function(num) { console.log(num); }).join(',');
         * // => logs each number and returns '1,2,3'
         *
         * _.forEach({ 'one': 1, 'two': 2, 'three': 3 }, function(num) { console.log(num); });
         * // => logs each number and returns the object (property order is not guaranteed across environments)
         */
        function forEach(collection, callback, thisArg) {
            if (callback && typeof thisArg == 'undefined' && isArray(collection)) {
                var index = -1,
                    length = collection.length;

                while (++index < length) {
                    if (callback(collection[index], index, collection) === false) {
                        break;
                    }
                }
            } else {
                baseEach(collection, callback, thisArg);
            }
            return collection;
        }

        /**
         * The opposite of `_.filter` this method returns the elements of a
         * collection that the callback does **not** return truey for.
         *
         * If a property name is provided for `callback` the created "_.pluck" style
         * callback will return the property value of the given element.
         *
         * If an object is provided for `callback` the created "_.where" style callback
         * will return `true` for elements that have the properties of the given object,
         * else `false`.
         *
         * @static
         * @memberOf _
         * @category Collections
         * @param {Array|Object|string} collection The collection to iterate over.
         * @param {Function|Object|string} [callback=identity] The function called
         *  per iteration. If a property name or object is provided it will be used
         *  to create a "_.pluck" or "_.where" style callback, respectively.
         * @param {*} [thisArg] The `this` binding of `callback`.
         * @returns {Array} Returns a new array of elements that failed the callback check.
         * @example
         *
         * var odds = _.reject([1, 2, 3, 4, 5, 6], function(num) { return num % 2 == 0; });
         * // => [1, 3, 5]
         *
         * var characters = [
         *   { 'name': 'barney', 'age': 36, 'blocked': false },
         *   { 'name': 'fred',   'age': 40, 'blocked': true }
         * ];
         *
         * // using "_.pluck" callback shorthand
         * _.reject(characters, 'blocked');
         * // => [{ 'name': 'barney', 'age': 36, 'blocked': false }]
         *
         * // using "_.where" callback shorthand
         * _.reject(characters, { 'age': 36 });
         * // => [{ 'name': 'fred', 'age': 40, 'blocked': true }]
         */
        function reject(collection, callback, thisArg) {
            callback = lodash.createCallback(callback, thisArg, 3);
            return filter(collection, function (value, index, collection) {
                return !callback(value, index, collection);
            });
        }

        /*--------------------------------------------------------------------------*/

        /**
         * Creates a function that, when called, invokes `func` with the `this`
         * binding of `thisArg` and prepends any additional `bind` arguments to those
         * provided to the bound function.
         *
         * @static
         * @memberOf _
         * @category Functions
         * @param {Function} func The function to bind.
         * @param {*} [thisArg] The `this` binding of `func`.
         * @param {...*} [arg] Arguments to be partially applied.
         * @returns {Function} Returns the new bound function.
         * @example
         *
         * var func = function(greeting) {
   *   return greeting + ' ' + this.name;
   * };
         *
         * func = _.bind(func, { 'name': 'fred' }, 'hi');
         * func();
         * // => 'hi fred'
         */
        function bind(func, thisArg) {
            return arguments.length > 2
                ? createWrapper(func, 17, slice(arguments, 2), null, thisArg)
                : createWrapper(func, 1, null, null, thisArg);
        }

        /*--------------------------------------------------------------------------*/

        /**
         * Produces a callback bound to an optional `thisArg`. If `func` is a property
         * name the created callback will return the property value for a given element.
         * If `func` is an object the created callback will return `true` for elements
         * that contain the equivalent object properties, otherwise it will return `false`.
         *
         * @static
         * @memberOf _
         * @category Utilities
         * @param {*} [func=identity] The value to convert to a callback.
         * @param {*} [thisArg] The `this` binding of the created callback.
         * @param {number} [argCount] The number of arguments the callback accepts.
         * @returns {Function} Returns a callback function.
         * @example
         *
         * var characters = [
         *   { 'name': 'barney', 'age': 36 },
         *   { 'name': 'fred',   'age': 40 }
         * ];
         *
         * // wrap to create custom callback shorthands
         * _.createCallback = _.wrap(_.createCallback, function(func, callback, thisArg) {
   *   var match = /^(.+?)__([gl]t)(.+)$/.exec(callback);
   *   return !match ? func(callback, thisArg) : function(object) {
   *     return match[2] == 'gt' ? object[match[1]] > match[3] : object[match[1]] < match[3];
   *   };
   * });
         *
         * _.filter(characters, 'age__gt38');
         * // => [{ 'name': 'fred', 'age': 40 }]
         */
        function createCallback(func, thisArg, argCount) {
            var type = typeof func;
            if (func == null || type == 'function') {
                return baseCreateCallback(func, thisArg, argCount);
            }
            // handle "_.pluck" style callback shorthands
            if (type != 'object') {
                return property(func);
            }
            var props = keys(func),
                key = props[0],
                a = func[key];

            // handle "_.where" style callback shorthands
            if (props.length == 1 && a === a && !isObject(a)) {
                // fast path the common case of providing an object with a single
                // property containing a primitive value
                return function (object) {
                    var b = object[key];
                    return a === b && (a !== 0 || (1 / a == 1 / b));
                };
            }
            return function (object) {
                var length = props.length,
                    result = false;

                while (length--) {
                    if (!(result = baseIsEqual(object[props[length]], func[props[length]], null, true))) {
                        break;
                    }
                }
                return result;
            };
        }

        /**
         * Converts the characters `&`, `<`, `>`, `"`, and `'` in `string` to their
         * corresponding HTML entities.
         *
         * @static
         * @memberOf _
         * @category Utilities
         * @param {string} string The string to escape.
         * @returns {string} Returns the escaped string.
         * @example
         *
         * _.escape('Fred, Wilma, & Pebbles');
         * // => 'Fred, Wilma, &amp; Pebbles'
         */
        function escape(string) {
            return string == null ? '' : String(string).replace(reUnescapedHtml, escapeHtmlChar);
        }

        /**
         * This method returns the first argument provided to it.
         *
         * @static
         * @memberOf _
         * @category Utilities
         * @param {*} value Any value.
         * @returns {*} Returns `value`.
         * @example
         *
         * var object = { 'name': 'fred' };
         * _.identity(object) === object;
         * // => true
         */
        function identity(value) {
            return value;
        }

        /**
         * A no-operation function.
         *
         * @static
         * @memberOf _
         * @category Utilities
         * @example
         *
         * var object = { 'name': 'fred' };
         * _.noop(object) === undefined;
         * // => true
         */
        function noop() {
            // no operation performed
        }

        /**
         * Creates a "_.pluck" style function, which returns the `key` value of a
         * given object.
         *
         * @static
         * @memberOf _
         * @category Utilities
         * @param {string} key The name of the property to retrieve.
         * @returns {Function} Returns the new function.
         * @example
         *
         * var characters = [
         *   { 'name': 'fred',   'age': 40 },
         *   { 'name': 'barney', 'age': 36 }
         * ];
         *
         * var getName = _.property('name');
         *
         * _.map(characters, getName);
         * // => ['barney', 'fred']
         *
         * _.sortBy(characters, getName);
         * // => [{ 'name': 'barney', 'age': 36 }, { 'name': 'fred',   'age': 40 }]
         */
        function property(key) {
            return function (object) {
                return object[key];
            };
        }

        /**
         * A micro-templating method that handles arbitrary delimiters, preserves
         * whitespace, and correctly escapes quotes within interpolated code.
         *
         * Note: In the development build, `_.template` utilizes sourceURLs for easier
         * debugging. See http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-sourceurl
         *
         * For more information on precompiling templates see:
         * http://lodash.com/custom-builds
         *
         * For more information on Chrome extension sandboxes see:
         * http://developer.chrome.com/stable/extensions/sandboxingEval.html
         *
         * @static
         * @memberOf _
         * @category Utilities
         * @param {string} text The template text.
         * @param {Object} data The data object used to populate the text.
         * @param {Object} [options] The options object.
         * @param {RegExp} [options.escape] The "escape" delimiter.
         * @param {RegExp} [options.evaluate] The "evaluate" delimiter.
         * @param {Object} [options.imports] An object to import into the template as local variables.
         * @param {RegExp} [options.interpolate] The "interpolate" delimiter.
         * @param {string} [sourceURL] The sourceURL of the template's compiled source.
         * @param {string} [variable] The data object variable name.
         * @returns {Function|string} Returns a compiled function when no `data` object
         *  is given, else it returns the interpolated text.
         * @example
         *
         * // using the "interpolate" delimiter to create a compiled template
         * var compiled = _.template('hello <%= name %>');
         * compiled({ 'name': 'fred' });
         * // => 'hello fred'
         *
         * // using the "escape" delimiter to escape HTML in data property values
         * _.template('<b><%- value %></b>', { 'value': '<script>' });
         * // => '<b>&lt;script&gt;</b>'
         *
         * // using the "evaluate" delimiter to generate HTML
         * var list = '<% _.forEach(people, function(name) { %><li><%- name %></li><% }); %>';
         * _.template(list, { 'people': ['fred', 'barney'] });
         * // => '<li>fred</li><li>barney</li>'
         *
         * // using the ES6 delimiter as an alternative to the default "interpolate" delimiter
         * _.template('hello ${ name }', { 'name': 'pebbles' });
         * // => 'hello pebbles'
         *
         * // using the internal `print` function in "evaluate" delimiters
         * _.template('<% print("hello " + name); %>!', { 'name': 'barney' });
         * // => 'hello barney!'
         *
         * // using a custom template delimiters
         * _.templateSettings = {
   *   'interpolate': /{{([\s\S]+?)}}/g
   * };
         *
         * _.template('hello {{ name }}!', { 'name': 'mustache' });
         * // => 'hello mustache!'
         *
         * // using the `imports` option to import jQuery
         * var list = '<% jq.each(people, function(name) { %><li><%- name %></li><% }); %>';
         * _.template(list, { 'people': ['fred', 'barney'] }, { 'imports': { 'jq': jQuery } });
         * // => '<li>fred</li><li>barney</li>'
         *
         * // using the `sourceURL` option to specify a custom sourceURL for the template
         * var compiled = _.template('hello <%= name %>', null, { 'sourceURL': '/basic/greeting.jst' });
         * compiled(data);
         * // => find the source of "greeting.jst" under the Sources tab or Resources panel of the web inspector
         *
         * // using the `variable` option to ensure a with-statement isn't used in the compiled template
         * var compiled = _.template('hi <%= data.name %>!', null, { 'variable': 'data' });
         * compiled.source;
         * // => function(data) {
   *   var __t, __p = '', __e = _.escape;
   *   __p += 'hi ' + ((__t = ( data.name )) == null ? '' : __t) + '!';
   *   return __p;
   * }
         *
         * // using the `source` property to inline compiled templates for meaningful
         * // line numbers in error messages and a stack trace
         * fs.writeFileSync(path.join(cwd, 'jst.js'), '\
         *   var JST = {\
   *     "main": ' + _.template(mainText).source + '\
   *   };\
         * ');
         */
        function template(text, data, options) {
            // based on John Resig's `tmpl` implementation
            // http://ejohn.org/blog/javascript-micro-templating/
            // and Laura Doktorova's doT.js
            // https://github.com/olado/doT
            var settings = lodash.templateSettings;
            text = String(text || '');

            // avoid missing dependencies when `iteratorTemplate` is not defined
            options = defaults({}, options, settings);

            var imports = defaults({}, options.imports, settings.imports),
                importsKeys = keys(imports),
                importsValues = values(imports);

            var isEvaluating,
                index = 0,
                interpolate = options.interpolate || reNoMatch,
                source = "__p += '";

            // compile the regexp to match each delimiter
            var reDelimiters = RegExp(
                (options.escape || reNoMatch).source + '|' +
                interpolate.source + '|' +
                (interpolate === reInterpolate ? reEsTemplate : reNoMatch).source + '|' +
                (options.evaluate || reNoMatch).source + '|$'
                , 'g');

            text.replace(reDelimiters, function (match, escapeValue, interpolateValue, esTemplateValue, evaluateValue, offset) {
                interpolateValue || (interpolateValue = esTemplateValue);

                // escape characters that cannot be included in string literals
                source += text.slice(index, offset).replace(reUnescapedString, escapeStringChar);

                // replace delimiters with snippets
                if (escapeValue) {
                    source += "' +\n__e(" + escapeValue + ") +\n'";
                }
                if (evaluateValue) {
                    isEvaluating = true;
                    source += "';\n" + evaluateValue + ";\n__p += '";
                }
                if (interpolateValue) {
                    source += "' +\n((__t = (" + interpolateValue + ")) == null ? '' : __t) +\n'";
                }
                index = offset + match.length;

                // the JS engine embedded in Adobe products requires returning the `match`
                // string in order to produce the correct `offset` value
                return match;
            });

            source += "';\n";

            // if `variable` is not specified, wrap a with-statement around the generated
            // code to add the data object to the top of the scope chain
            var variable = options.variable,
                hasVariable = variable;

            if (!hasVariable) {
                variable = 'obj';
                source = 'with (' + variable + ') {\n' + source + '\n}\n';
            }
            // cleanup code by stripping empty strings
            source = (isEvaluating ? source.replace(reEmptyStringLeading, '') : source)
                .replace(reEmptyStringMiddle, '$1')
                .replace(reEmptyStringTrailing, '$1;');

            // frame code as the function body
            source = 'function(' + variable + ') {\n' +
                (hasVariable ? '' : variable + ' || (' + variable + ' = {});\n') +
                "var __t, __p = '', __e = _.escape" +
                (isEvaluating
                        ? ', __j = Array.prototype.join;\n' +
                    "function print() { __p += __j.call(arguments, '') }\n"
                        : ';\n'
                ) +
                source +
                'return __p\n}';

            // Use a sourceURL for easier debugging.
            // http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-sourceurl
            var sourceURL = '\n/*\n//# sourceURL=' + (options.sourceURL || '/lodash/template/source[' + (templateCounter++) + ']') + '\n*/';

            try {
                var result = Function(importsKeys, 'return ' + source + sourceURL).apply(undefined, importsValues);
            } catch (e) {
                e.source = source;
                throw e;
            }
            if (data) {
                return result(data);
            }
            // provide the compiled function's source by its `toString` method, in
            // supported environments, or the `source` property as a convenience for
            // inlining compiled templates during the build process
            result.source = source;
            return result;
        }

        /*--------------------------------------------------------------------------*/

        lodash.assign = assign;
        lodash.bind = bind;
        lodash.createCallback = createCallback;
        lodash.defaults = defaults;
        lodash.filter = filter;
        lodash.forEach = forEach;
        lodash.forIn = forIn;
        lodash.forOwn = forOwn;
        lodash.keys = keys;
        lodash.property = property;
        lodash.reject = reject;
        lodash.values = values;

        lodash.each = forEach;
        lodash.extend = assign;
        lodash.select = filter;

        /*--------------------------------------------------------------------------*/

        // add functions that return unwrapped values when chaining
        lodash.clone = clone;
        lodash.cloneDeep = cloneDeep;
        lodash.escape = escape;
        lodash.find = find;
        lodash.identity = identity;
        lodash.isArguments = isArguments;
        lodash.isArray = isArray;
        lodash.isFunction = isFunction;
        lodash.isObject = isObject;
        lodash.isString = isString;
        lodash.noop = noop;
        lodash.template = template;

        lodash.detect = find;
        lodash.findWhere = find;

        /*--------------------------------------------------------------------------*/

        /**
         * The semantic version number.
         *
         * @static
         * @memberOf _
         * @type string
         */
        lodash.VERSION = '2.4.1';

        /*--------------------------------------------------------------------------*/

        if (freeExports && freeModule) {
            // in Node.js or RingoJS
            if (moduleExports) {
                (freeModule.exports = lodash)._ = lodash;
            }
            // in Narwhal or Rhino -require
            else {
                freeExports._ = lodash;
            }
        }

    }.call(this));

});
require.register("side-comments/js/helpers/mobile-check.js", function (exports, require, module) {
    module.exports = function () {
        var check = false;
        (function (a) {
            if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4)))check = true
        })(navigator.userAgent || navigator.vendor || window.opera);
        return check;
    }
});


require.register("side-comments/templates/section.html", function (exports, require, module) {
    module.exports =
'<div class="side-comment <%= sectionClasses %>">\n '+
    '<a href="#" class="marker">\n <span><%= comments.length %></span>\n  </a>\n  \n '+
    '<div class="comments-wrapper">\n '+
        '<div class="comments-header clearfix">\n '+
        '<div class="pull-left">\n '+
            '<h5 class="font-roboto titulo-comments"><strong>Comentários deste trecho</strong></h5>\n '+
        '</div>\n ' +
            '<div class="pull-right close-btn">\n '+
                '<i class="fa fa-times" onClick="document.body.click();"></i>'+
            '</div>\n ' +
        '</div>\n ' +
        '<div class="clearfix comments-estructure">\n '+
            '<ul class="comments" data-root-id="0">\n '+
                '<% _.each(comments, function( comment ){ %>\n '+
                    '<%= _.template(commentTemplate, { comment: comment, currentUser: currentUser }) %>\n '+
                    '<% }) %>\n ' +
            '</ul>\n \n ' +
        '</div>\n ' +
        '<% if (currentUser){ %>\n ' +
        '<a href="#" class="add-comment mt-sm btn btn-success btn-md" data-parent="0" data-comment="">Deixe seu comentário</a>\n \n '+
        
        '<div class="comment-form" data-parent="0" data-comment="">\n '+
            '<div class="author-avatar">\n ' +
                '<img src="<%= currentUser.avatarUrl %>">\n '+
            '</div>\n ' +
            '<p class="author-name">\n <%= currentUser.name %>\n        </p>\n ' +
            '<div class="comment-box" contenteditable="true" data-placeholder-content="Deixe seu comentário">' +
            '</div>\n ' +
            '<div class="ml-md mt-sm">\n ' +
                '<a href="#" class="action-link post btn btn-default" data-parent="0" data-comment="">Enviar</a>\n ' +
                '<a href="#" class="action-link cancel btn btn-default" data-parent="0" data-comment="">Cancelar</a>\n ' +
            '</div>\n ' +
        '</div>\n ' +
        '<% } %>' +
    '</div>\n' +
'</div>'
    ;
});

require.register("side-comments/templates/comment.html", function (exports, require, module) {
    module.exports = 
'<li class="clearfix" data-comment-id="<%= comment.commentID %>" data-parent-id="<%= comment.parentID%>">\n  ' +
    '<div class="clearfix">\n ' +
        '<div class="author-avatar">\n ' +
                '<img src="<%= comment.authorAvatarUrl %>">\n ' +
        '</div>\n  ' +
        '<div class="comentario-fill">\n  ' +
            '<h6 class="author-name">\n<%= comment.authorName %>\n</h6>\n ' +
            '<p class="comment-time">\n    <%= comment.time %>\n  </p>\n ' +
            '<p class="comment">\n    <%= comment.comment %>\n  </p>\n ' +
                '<% if (currentUser && comment.authorId === currentUser.id){ %>\n ' +
                    '<p><a href="#" class="fontsize-sm red">Deletar</a></p>\n ' +
                '<% } %>\n' +
            '<div class="comment-weight-container clearfix">\n' +
                //'<span id="comment-weight-value-<%= comment.commentID %>"><%= comment.karma %></span>\n ' +

                '<div class="mt-xs">\n' +
                    '<a data-comment-id="<%= comment.commentID %>" class="vote-up btn btn-default btn-xs fontsize-sm text-green" href="#"><i class="fa fa-thumbs-o-up"></i> Concordo <span id="comment-upvote-value-<%= comment.commentID %>"><%= comment.upvotes %></span></a> \n ' +
                    '<a data-comment-id="<%= comment.commentID %>" class="vote-down btn btn-default btn-xs fontsize-sm red" href="#"><i class="fa fa-thumbs-o-down"></i> Discordo <span id="comment-downvote-value-<%= comment.commentID %>"><%= comment.downvotes %></span></a>\n ' +        
                '</div>\n ' +
                '<% if (currentUser){ %>\n ' +
                '<div class="mt-xs">\n' +
                    '<a href="#" class="add-reply fontsize-sm" data-parent="<%= comment.parentID%>" data-comment="<%= comment.commentID %>"> <i class="fa fa-comment-o"></i> Responder</a>\n \n  ' +
                '</div>\n ' +   
                '<% } %>\n' + 
            '</div>\n ' +
        '</div>\n  ' +
    '</div>\n  ' +

    '<% if (currentUser){ %>\n     ' +


    '<div class="comment-form clearfix" data-parent="<%= comment.parentID%>" data-comment="<%= comment.commentID %>">\n ' +
        '<div class="author-avatar">\n ' +
            '<img src="<%= currentUser.avatarUrl %>">\n ' +
        '</div>\n ' +
        '<div class="comentario-fill">\n  ' +
            '<p class="author-name">\n <%= currentUser.name %>\n </p>\n ' +
            '<div class="comment-box" contenteditable="true" data-parent="<%= comment.parentID%>" data-comment="<%= comment.commentID %>" data-placeholder-content="Responder">' +
            '</div>\n ' +
            '<div class="actions">\n ' +
                '<a href="#" class="action-link reply btn btn-default btn-sm text-blue mr-md" data-parent="<%= comment.parentID %>" data-comment="<%= comment.commentID %>">Enviar</a>\n ' +
                '<a href="#" class="action-link cancel btn btn-default btn-sm red" data-parent="<%= comment.parentID %>" data-comment="<%= comment.commentID %>">Cancelar</a>\n ' +
            '</div>\n ' +
        '</div>\n ' +
    '</div>\n ' +
    '<% } %>' +
    
'</li>'
        ;
});


require.alias("component-emitter/index.js", "side-comments/deps/emitter/index.js");
require.alias("component-emitter/index.js", "emitter/index.js");

require.alias("side-comments/js/main.js", "side-comments/index.js");
